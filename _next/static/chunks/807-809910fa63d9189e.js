"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[807],{5807:function(e,t,i){i.r(t);var s=i(74),a=i(8868),n=i(7427),l=i(8698),o=i(6374),r=i(1616),d=i(1355),h=i(2289),c=i(5781),p=i(3382),u=i(8907),m=i(6614),y=i(6657),g=i(1387),x=i(662),L=i(5218),b=i(7125),T=i(1878),w=i(7039),f=i(2713),S=i(7521),k=i(5195),F=i(4185),z=i(4418),C=i(4661),D=i(751),v=i(4231),A=i.n(v),E=i(1753),I=i.n(E),j=i(4073),P=i.n(j),B=i(3538),O=i(635),_=i(8340),R=i(5374);function U(e){return e.key=e.name,e}(0,b.Mg)();let W=(0,a.ZC)({name:{cursor:"pointer","&:hover":{textDecoration:"underline"}}}),G=(e,t)=>e&&t?t({...e,styles:(0,a.E$)(e.styles,{root:{paddingTop:0}})}):null;function M(e,t){let i=e.toLocaleLowerCase().localeCompare(t.toLocaleLowerCase());return 0!==i?i:e.localeCompare(t)}let N=new class{get breadcrumbItems(){let e="",t=this.path.split("/").filter(Boolean).map(t=>({key:e+="/"+t,text:t,onClick:(e,t)=>{t&&this.pushPathQuery(t.key)}}));return t.unshift({key:"/",text:"Device",onClick:()=>this.pushPathQuery("/")}),t[t.length-1].isCurrentItem=!0,delete t[t.length-1].onClick,t}get menuItems(){let e=[];return(e.push({key:"goBack",text:"",iconProps:{iconName:R.PJ.ChevronLeft,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:()=>{let e=P().dirname(this.path);return e!==this.path&&(this.path=e,this.loadFiles()),!1}}),0===this.selectedItems.length)?e.push({key:"upload",text:"Upload",iconProps:{iconName:R.PJ.CloudArrowUp,style:{height:20,fontSize:20,lineHeight:1.5}},disabled:!_.GLOBAL_STATE.adb,onClick:()=>((async()=>{let e=await (0,R.oT)({multiple:!0});for(let t=0;t<e.length;t++){let i=e.item(t);await this.upload(i)}})(),!1)}):e.push({key:"download",text:"Download",iconProps:{iconName:R.PJ.CloudArrowDown,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:()=>(this.download(),!1)},{key:"delete",text:"Delete",iconProps:{iconName:R.PJ.Delete,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:()=>((async()=>{try{for(let e of this.selectedItems){let t=await _.GLOBAL_STATE.adb.rm(P().resolve(this.path,e.name));if(t){_.GLOBAL_STATE.showErrorDialog(t);return}}}catch(e){_.GLOBAL_STATE.showErrorDialog(e)}finally{this.loadFiles()}})(),!1)}),e}get sortedList(){let e=this.items.slice();return e.sort((e,t)=>{let i;let s=e.type===S.LinuxFileType.File?1:0,a=t.type===S.LinuxFileType.File?1:0;if(s!==a)i=s-a;else{let s=e[this.sortKey],a=t[this.sortKey];i=s===a?M(e.name,t.name):"string"==typeof s?M(s,a):s<a?-1:1}return this.sortDescending&&(i*=-1),i}),e}get columns(){var e;let t=[{key:"type",name:"File Type",iconName:R.PJ.Document20,isIconOnly:!0,minWidth:20,maxWidth:20,isCollapsible:!0,onRender(e){let t;switch(e.type){case S.LinuxFileType.Link:t="linkedfolder16_svg";break;case S.LinuxFileType.Directory:({iconName:t}=(0,T.EX)({type:w.I.folder}));break;case S.LinuxFileType.File:({iconName:t}=(0,T.EX)({extension:P().extname(e.name)}));break;default:({iconName:t}=(0,T.EX)({type:w.I.genericFile}))}let i=(0,a.q7)(t).code.props.src;return(0,s.jsx)(n.J,{imageProps:{crossOrigin:"anonymous",src:i},style:{width:20,height:20}})}},{key:"name",name:"Name",minWidth:0,isRowHeader:!0,onRender:e=>(0,s.jsx)("span",{className:W.name,"data-selection-invoke":!0,children:e.name})},{key:"permission",name:"Permission",minWidth:0,isCollapsible:!0,onRender:e=>"".concat((e.mode>>6&4).toString(8)).concat((e.mode>>3&4).toString(8)).concat((4&e.mode).toString(8))},{key:"size",name:"Size",minWidth:0,isCollapsible:!0,onRender:e=>e.type===S.LinuxFileType.File?(0,R.BU)(Number(e.size)):""},{key:"mtime",name:"Last Modified Time",minWidth:150,isCollapsible:!0,onRender:e=>new Date(1e3*Number(e.mtime)).toLocaleString()}];for(let i of((null===(e=_.GLOBAL_STATE.adb)||void 0===e?void 0:e.supportsFeature(S.AdbFeature.ListV2))&&t.push({key:"ctime",name:"Creation Time",minWidth:150,isCollapsible:!0,onRender:e=>new Date(1e3*Number(e.ctime)).toLocaleString()},{key:"atime",name:"Last Access Time",minWidth:150,isCollapsible:!0,onRender:e=>new Date(1e3*Number(e.atime)).toLocaleString()}),t))i.onColumnClick=(e,t)=>{this.sortKey===t.key?(0,C.z)(()=>this.sortDescending=!this.sortDescending):(0,C.z)(()=>{this.sortKey=t.key,this.sortDescending=!1})},i.key===this.sortKey&&(i.isSorted=!0,i.isSortedDescending=this.sortDescending);return t}getFileStream(e,t,i){return e.read(P().resolve(t,i))}async addDirectory(e,t,i,s){if("."!==s){let e=new z.Ud(s+"/");t.add(e),e.push(F.RJ,!0)}for(let a of(await e.readdir(P().resolve(i,s))))if("."!==a.name&&".."!==a.name)switch(a.type){case S.LinuxFileType.Directory:await this.addDirectory(e,t,i,P().resolve(s,a.name));break;case S.LinuxFileType.File:await this.addFile(e,t,i,P().resolve(s,a.name))}}async addFile(e,t,i,s){let a=new z.Ud(s);t.add(a),await this.getFileStream(e,i,s).pipeTo(new k.WritableStream({write(e){a.push(e)},close(){a.push(F.RJ,!0)}}))}async download(){let e=await _.GLOBAL_STATE.adb.sync();try{if(1===this.selectedItems.length){let t=this.selectedItems[0];switch(t.type){case S.LinuxFileType.Directory:{let i=(0,R.yH)("".concat(this.selectedItems[0].name,".zip")),s=i.getWriter(),a=new z.sZ((e,t,i)=>{s.write(t),i&&s.close()});await this.addDirectory(e,a,P().resolve(this.path,t.name),"."),a.end();break}case S.LinuxFileType.File:await this.getFileStream(e,this.path,t.name).pipeTo((0,R.yH)(t.name,Number(t.size)))}return}let t=(0,R.yH)("".concat(P().basename(this.path),".zip")),i=t.getWriter(),s=new z.sZ((e,t,s)=>{i.write(t),s&&i.close()});for(let t of this.selectedItems)switch(t.type){case S.LinuxFileType.Directory:await this.addDirectory(e,s,this.path,t.name);break;case S.LinuxFileType.File:await this.addFile(e,s,this.path,t.name)}s.end()}catch(e){_.GLOBAL_STATE.showErrorDialog(e)}finally{e.dispose()}}changeDirectory(e){this.path!==e&&(this.path=e,_.GLOBAL_STATE.adb&&this.loadFiles())}constructor(){this.initial=!0,this.visible=!1,this.path="/",this.loading=!1,this.items=[],this.sortKey="name",this.sortDescending=!1,this.uploading=!1,this.uploadPath=void 0,this.uploadedSize=0,this.uploadTotalSize=0,this.debouncedUploadedSize=0,this.uploadSpeed=0,this.selectedItems=[],this.contextMenuTarget=void 0,this.pushPathQuery=e=>{I().push({query:{...I().query,path:e}})},this.loadFiles=(0,R.FW)(async e=>{let t=this.path;if((0,C.z)(()=>this.items=[]),!_.GLOBAL_STATE.adb)return;(0,C.z)(()=>this.loading=!0);let i=await _.GLOBAL_STATE.adb.sync(),s=[],a=[],n=setInterval(()=>{e.aborted||(0,C.z)(()=>this.items=s.slice())},1e3);try{for await(let n of i.opendir(t)){if(e.aborted)return;"."!==n.name&&".."!==n.name&&(n.type===S.LinuxFileType.Link?a.push(n):s.push(U(n)))}for(let n of a){if(e.aborted)return;await i.isDirectory(P().resolve(t,n.name))||(n.mode=S.LinuxFileType.File<<12|n.permission,n.size=0n),s.push(U(n))}if(e.aborted)return;(0,C.z)(()=>this.items=s)}finally{e.aborted||(0,C.z)(()=>this.loading=!1),clearInterval(n),i.dispose()}}),this.upload=async e=>{let t=await _.GLOBAL_STATE.adb.sync();try{let i=P().resolve(this.path,e.name);(0,C.z)(()=>{this.uploading=!0,this.uploadPath=e.name,this.uploadedSize=0,this.uploadTotalSize=e.size,this.debouncedUploadedSize=0,this.uploadSpeed=0});let s=setInterval((0,C.aD)(()=>{this.uploadSpeed=this.uploadedSize-this.debouncedUploadedSize,this.debouncedUploadedSize=this.uploadedSize}),1e3);try{let s=Date.now();await t.write({filename:i,file:(0,R.Xd)(e).pipeThrough(new k.WrapConsumableStream).pipeThrough(new R.hK((0,C.aD)(e=>{this.uploadedSize=e}))),type:S.LinuxFileType.File,permission:438,mtime:e.lastModified/1e3}),console.log("Upload speed:",(e.size/(Date.now()-s)*1e3/1024/1024).toFixed(2),"MB/s"),(0,C.z)(()=>{this.uploadSpeed=this.uploadedSize-this.debouncedUploadedSize,this.debouncedUploadedSize=this.uploadedSize})}finally{clearInterval(s)}}catch(e){_.GLOBAL_STATE.showErrorDialog(e)}finally{t.dispose(),this.loadFiles(),(0,C.z)(()=>{this.uploading=!1})}},(0,C.ky)(this,{initial:!1,items:C.LO.shallow,pushPathQuery:!1,changeDirectory:C.aD.bound,loadFiles:!1}),(0,C.EH)(()=>{_.GLOBAL_STATE.adb?this.initial&&this.visible&&(this.initial=!1,this.loadFiles()):this.initial=!0})}},H=(0,D.Pi)(()=>(0,s.jsx)(l.V,{hidden:!N.uploading,dialogContentProps:{title:"Uploading...",subText:N.uploadPath},children:(0,s.jsx)(o.Y,{description:(0,R.CY)(N.debouncedUploadedSize,N.uploadTotalSize,N.uploadSpeed),percentComplete:N.uploadedSize/N.uploadTotalSize})}));t.default=(0,D.Pi)(()=>{(0,B.useEffect)(()=>((0,C.z)(()=>{N.visible=!0}),()=>{(0,C.z)(()=>{N.visible=!1})}),[]);let e=(0,E.useRouter)();(0,B.useEffect)(()=>{let t=e.query.path;if(!t){e.replace({query:{...e.query,path:N.path}});return}Array.isArray(t)&&(t=t[0]),N.changeDirectory(t)},[e]);let[t,i]=(0,B.useState)(),a=(0,B.useCallback)(async e=>{let t=await _.GLOBAL_STATE.adb.sync();try{let s=t.read(e),a=new Response(s),n=await a.blob(),l=globalThis.URL.createObjectURL(n);i(l)}finally{t.dispose()}},[]),n=(0,B.useCallback)(()=>{i(void 0)},[]),l=(0,B.useCallback)(e=>{switch(e.type){case S.LinuxFileType.Link:case S.LinuxFileType.Directory:N.pushPathQuery(P().resolve(N.path,e.name));break;case S.LinuxFileType.File:switch(P().extname(e.name)){case".jpg":case".png":case".svg":case".gif":a(P().resolve(N.path,e.name))}}},[a]),o=(0,f.B)(()=>new r.Y({onSelectionChanged(){(0,C.z)(()=>{N.selectedItems=o.getSelection()})}})),b=(0,B.useCallback)((e,t,i)=>!!i&&(N.menuItems.length&&(0,C.z)(()=>{N.contextMenuTarget=i}),!1),[]),T=(0,B.useCallback)(()=>{(0,C.z)(()=>N.contextMenuTarget=void 0)},[]);return(0,s.jsxs)(d.K,{...R.LE,children:[(0,s.jsx)(A(),{children:(0,s.jsx)("title",{children:"File Manager"})}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(O.X3,{items:N.menuItems}),(0,s.jsx)("div",{style:{marginLeft:"25%",fontSize:"1.2em",fontWeight:"600"},children:"File Manager"})]}),(0,s.jsxs)(h.v,{grow:!0,styles:{root:{margin:"-8px -16px -16px -16px",padding:"8px 16px 16px 16px",overflowY:"auto"}},children:[(0,s.jsx)(c.x,{selection:o,children:(0,s.jsx)(p.J,{items:N.sortedList,columns:N.columns,setKey:N.path,selection:o,layoutMode:u.Oh.justified,enableShimmer:N.loading&&0===N.items.length,onItemInvoked:l,onItemContextMenu:b,onRenderDetailsHeader:G,usePageCache:!0,useReducedRowRenderer:!0})}),t&&(0,s.jsx)(m.m,{children:(0,s.jsx)(y.a,{onClick:n,children:(0,s.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)("img",{src:t,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}})})})})]}),(0,s.jsx)(O.ag,{children:(0,s.jsx)(g.r,{items:N.menuItems,hidden:!N.contextMenuTarget,directionalHint:x.b.bottomLeftEdge,target:N.contextMenuTarget,onDismiss:T,contextualMenuItemAs:e=>(0,s.jsx)(L.W,{...e,hasIcons:!1})})}),(0,s.jsx)(H,{})]})})}}]);
//# sourceMappingURL=807-809910fa63d9189e.js.map