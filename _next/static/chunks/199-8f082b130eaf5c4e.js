"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[199],{7368:function(e,t,i){i.d(t,{Z:function(){return d}});var r=i(1485),a=i(3538),s=i(10),n=i(1740),o=i(9757),l=i(5596),d=function(e){var t=e.className,i=a.useState(function(){return(0,n.z)()})[0],d=e.id,c=void 0===d?i:d,h=a.useRef({hostId:c,rootRef:a.useRef(null),notifyLayersChanged:function(){}});return a.useImperativeHandle(e.componentRef,function(){return h.current}),a.useEffect(function(){(0,l._Y)(c,h.current),(0,l.EQ)(c)},[]),(0,s.k)(function(){(0,l.nw)(c,h.current),(0,l.EQ)(c)}),a.createElement("div",(0,r.pi)({},e,{className:(0,o.i)("ms-LayerHost",t),ref:h.current.rootRef}))}},1812:function(e,t,i){e.exports=i.p+"static/media/server.e15da049.bin"},7035:function(e,t,i){e.exports=i.p+"static/media/worker.403c83a2.js"},1454:function(e,t,i){i.d(t,{NE:function(){return o},vg:function(){return w}});var r=i(7521),a=i(6341),s=i(5195);class n extends Error{output;constructor(e){super("scrcpy server exited prematurely"),this.output=e}}class o{static async pushServer(e,t,i=a.K1){let r=await e.sync();try{await r.write({filename:i,file:t})}finally{await r.dispose()}}static async start(e,t,i,a){let l,d;try{try{l=a.createConnection(e),await l.initialize()}catch(t){if(t instanceof r.AdbReverseNotSupportedError)a.tunnelForwardOverride=!0,l=a.createConnection(e),await l.initialize();else throw l=void 0,t}d=await e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",i,...a.serialize()],{protocols:[r.AdbSubprocessNoneProtocol]});let c=d.stdout.pipeThrough(new s.DecodeUtf8Stream).pipeThrough(new s.SplitStringStream("\n")),h=[],u=new s.AbortController,p=c.pipeTo(new s.WritableStream({write(e){h.push(e)}}),{signal:u.signal,preventCancel:!0}).catch(e=>{if(!u.signal.aborted)throw e}),f=await Promise.race([d.exit.then(()=>{throw new n(h)}),l.getStreams()]);return u.abort(),await p,new o({options:a,process:d,stdout:function(...e){return new s.PushReadableStream(async t=>{for(let i of e){let e=i.getReader();for(;;){let{done:i,value:r}=await e.read();if(i)break;await t.enqueue(r)}}})}(new s.PushReadableStream(async e=>{for(let t of h)await e.enqueue(t)}),c),videoStream:f.video,audioStream:f.audio,controlStream:f.control})}catch(e){throw await d?.kill(),e}finally{l?.dispose()}}static async getEncoders(e,t,i,r){return r.setListEncoders(),await r.getEncoders(e,t,i)}static async getDisplays(e,t,i,r){return r.setListDisplays(),await r.getDisplays(e,t,i)}#e;#t;#i;get stdout(){return this.#i}get exit(){return this.#t.exit}#r;get screenWidth(){return this.#r}#a;get screenHeight(){return this.#a}#s;get videoStream(){return this.#s}#n;get audioStream(){return this.#n}#o;get controlMessageWriter(){return this.#o}#l;get deviceMessageStream(){return this.#l}constructor({options:e,process:t,stdout:i,videoStream:r,audioStream:s,controlStream:n}){this.#e=e,this.#t=t,this.#i=i,this.#s=r?this.#d(r):void 0,this.#n=s?this.#c(s):void 0,n&&(this.#o=new a.aA(n.writable.getWriter(),e),this.#l=n.readable.pipeThrough(new a.lq))}async #d(e){let{stream:t,metadata:i}=await this.#e.parseVideoStreamMetadata(e);return{stream:t.pipeThrough(this.#e.createMediaStreamTransformer()).pipeThrough(new s.InspectStream(e=>{if("configuration"===e.type)switch(i.codec){case a.WP.H264:{let{croppedWidth:t,croppedHeight:i}=(0,a.VM)(e.data);this.#r=t,this.#a=i;break}case a.WP.H265:{let{croppedWidth:t,croppedHeight:i}=(0,a.hA)(e.data);this.#r=t,this.#a=i}}})),metadata:i}}async #c(e){let t=await this.#e.parseAudioStreamMetadata(e);switch(t.type){case"disabled":case"errored":return t;case"success":return{...t,stream:t.stream.pipeThrough(this.#e.createMediaStreamTransformer())};default:throw Error(`Unexpected audio metadata type ${t.type}`)}}async close(){await this.#t.kill()}}var l=i(3639);class d{adb;options;socketName;constructor(e,t){this.adb=e,this.options=t,this.socketName=this.getSocketName()}initialize(){}getSocketName(){let e="localabstract:scrcpy";return void 0!==this.options.scid&&this.options.scid>=0&&(e+="_"+this.options.scid.toString(16).padStart(8,"0")),e}dispose(){}}class c extends d{#h=!1;#u(){return this.adb.createSocket(this.socketName)}async #p(e){for(let t=0;!this.#h&&t<100;t+=1)try{let t=await this.#u();if(e){let e=new s.BufferedReadableStream(t.readable);return await e.readExactly(1),{readable:e.release(),writable:t.writable}}return t}catch(e){await (0,l.delay)(100)}throw Error("Can't connect to server after 100 retries")}async getStreams(){let{sendDummyByte:e}=this.options,t={};if(this.options.video){let i=await this.#p(e);t.video=i.readable,e=!1}if(this.options.audio){let i=await this.#p(e);t.audio=i.readable,e=!1}if(this.options.control){let i=await this.#p(e);t.control=i,e=!1}return t}dispose(){this.#h=!0}}class h extends d{#f;#m;async initialize(){await this.adb.reverse.remove(this.socketName).catch(e=>{if(e instanceof r.AdbReverseNotSupportedError)throw e});let e=new s.TransformStream;this.#f=e.readable.getReader();let t=e.writable.getWriter();this.#m=await this.adb.reverse.add(this.socketName,e=>{t.write(e)})}async #w(){return(await this.#f.read()).value}async getStreams(){let e={};if(this.options.video){let t=await this.#w();e.video=t.readable}if(this.options.audio){let t=await this.#w();e.audio=t.readable}if(this.options.control){let t=await this.#w();e.control=t}return e}dispose(){this.adb.reverse.remove(this.#m).catch(r.NOOP)}}class u extends a.nW{get defaults(){return this._base.defaults}tunnelForwardOverride=!1;constructor(e){super(e,e.value)}serialize(){return this._base.serialize()}}class p extends u{static createConnection(e,t,i){return i?new c(e,t):new h(e,t)}static async getEncoders(e,t,i,r){let a=await o.start(e,t,i,r),n=[];return await a.stdout.pipeTo(new s.WritableStream({write:e=>{let t=r.parseEncoder(e);t&&n.push(t)}})),n}static async getDisplays(e,t,i,r){try{let a=await o.start(e,t,i,r);throw await a.close(),Error("Unexpected server output")}catch(e){if(e instanceof n){let t=[];for(let i of e.output){let e=r.parseDisplay(i);e&&t.push(e)}return t}throw e}}getEncoders(e,t,i){return p.getEncoders(e,t,i,this)}getDisplays(e,t,i){return p.getDisplays(e,t,i,this)}createConnection(e){return p.createConnection(e,{scid:-1,video:!0,audio:!1,control:!0,sendDummyByte:!0},this.tunnelForwardOverride||this.value.tunnelForward)}}class f extends u{static async getEncoders(e,t,i,r){try{let a=await o.start(e,t,i,r);throw await a.close(),Error("Unexpected server output")}catch(e){if(e instanceof n){let t=[];for(let i of e.output){let e=r.parseEncoder(i);e&&t.push(e)}return t}throw e}}async getEncoders(e,t,i){return f.getEncoders(e,t,i,this)}getDisplays(e,t,i){return p.getDisplays(e,t,i,this)}createConnection(e){return p.createConnection(e,{scid:this.value.scid.value,video:!0,audio:this.value.audio,control:this.value.control,sendDummyByte:this.value.sendDummyByte},this.tunnelForwardOverride||this.value.tunnelForward)}}class m extends u{async getEncoders(e,t,i){return f.getEncoders(e,t,i,this)}getDisplays(e,t,i){return p.getDisplays(e,t,i,this)}createConnection(e){return p.createConnection(e,{scid:this.value.scid.value,video:this.value.video,audio:this.value.audio,control:this.value.control,sendDummyByte:this.value.sendDummyByte},this.tunnelForwardOverride||this.value.tunnelForward)}}class w extends m{}},5765:function(e,t,i){i.d(t,{d:function(){return r},q:function(){return a}});let r="2.5",a=new i.U(i(1812))},1490:function(e,t,i){i.d(t,{C:function(){return s},ED:function(){return a},PT:function(){return n}});class r{#b;#v;#g=[];constructor(e){this.#b=new AudioContext({latencyHint:"interactive",sampleRate:e})}feed(e){if(void 0===this.#v){this.#g.push(e);return}this.feedCore(this.#v,e)}async start(){for(let e of(await this.#b.audioWorklet.addModule(new i.U(i(7035))),this.#v=new AudioWorkletNode(this.#b,this.sourceName,{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.#v.connect(this.#b.destination),this.#g))this.feedCore(this.#v,e);this.#g.length=0}async stop(){this.#v?.disconnect(),this.#v=void 0,await this.#b.close()}}class a extends r{sourceName="int16-source-processor";feedCore(e,t){(0!==t.byteOffset||t.byteLength!==t.buffer.byteLength)&&(t=t.slice());let{buffer:i}=t;e.port.postMessage([i],[i])}}class s extends r{sourceName="float32-source-processor";feedCore(e,t){(0!==t.byteOffset||t.byteLength!==t.buffer.byteLength)&&(t=t.slice());let{buffer:i}=t;e.port.postMessage([i],[i])}}class n extends r{sourceName="float32-planer-source-processor";feedCore(e,t){let i=t.map(e=>((0!==e.byteOffset||e.byteLength!==e.buffer.byteLength)&&(e=e.slice()),e.buffer));e.port.postMessage(i,i)}}},8480:function(e,t,i){let r,a;i.d(t,{EV:function(){return w}});var s=i(3639),n=i(6341),o=i(5195),l=i(6792);let d=!1,c=[],h=0,u=new Map;class p extends l.Xn{streamId;#y=new l.vp;get onPictureReady(){return this.#y.event}constructor(e){var t;super(),this.streamId=e,this.addDisposable((t=this.#L,u.set(e,t),{dispose(){u.delete(e)}}))}#L=e=>{this.#y.fire(e)};feed(e){r.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),r.postMessage({type:"release",renderStateId:this.streamId})}}let f=()=>{};function m(){return a||(a=Promise.all([i.e(656).then(i.t.bind(i,1656,19)),i.e(875).then(i.t.bind(i,7875,19))]).then(([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t}))),a}class w{static capabilities={h264:{maxProfile:n.vo.Baseline,maxLevel:n.Nm.Level4}};#E;get renderer(){return this.#E}#x=0;get frameRendered(){return this.#x}#S=0;get frameSkipped(){return this.#S}#k;get writable(){return this.#k}#M;#A;constructor(){m(),this.#E=document.createElement("canvas"),this.#k=new o.WritableStream({write:async e=>{switch(e.type){case"configuration":await this.#N(e.data);break;case"data":{if(!this.#A)throw Error("Decoder not configured");let t=await this.#A.promise;t.feed(e.data.slice().buffer)}}}})}async #N(e){this.dispose(),this.#A=new s.PromiseResolver;let{YuvBuffer:t,YuvCanvas:a}=await m();this.#M||(this.#M=a.attach(this.#E));let{encodedWidth:o,encodedHeight:l,croppedWidth:f,croppedHeight:w,cropLeft:b,cropTop:v}=(0,n.VM)(e),g=o/2,y=l/2,L=t.format({width:o,height:l,chromaWidth:g,chromaHeight:y,cropLeft:b,cropTop:v,cropWidth:f,cropHeight:w,displayWidth:f,displayHeight:w}),E=await function(){if(r||(r=new Worker(i.tu(new URL(i.p+i.u(818),i.b)))).addEventListener("message",({data:e})=>{switch(e.type){case"decoderReady":for(let e of(d=!0,c))e.resolve(new p(h)),h+=1;c.length=0;break;case"pictureReady":u.get(e.renderStateId)?.(e)}}),!d){let e=new s.PromiseResolver;return c.push(e),e.promise}let e=new p(h);return h+=1,Promise.resolve(e)}();this.#A.resolve(E);let x=o*l,S=x+g*y;E.onPictureReady(({data:e})=>{this.#x+=1;let i=new Uint8Array(e),r=t.frame(L,t.lumaPlane(L,i,o,0),t.chromaPlane(L,i,g,x),t.chromaPlane(L,i,g,S));this.#M.drawFrame(r)}),E.feed(e.slice().buffer)}dispose(){this.#A?.promise.then(e=>e.dispose()).catch(f),this.#A=void 0}}},533:function(e,t,i){i.d(t,{H:function(){return o}});var r=i(6341),a=i(5195);function s(e){return e.toString(16).padStart(2,"0").toUpperCase()}function n(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}class o{static isSupported(){return void 0!==globalThis.VideoDecoder}static capabilities={h264:{},h265:{}};#C;get codec(){return this.#C}#k;get writable(){return this.#k}#E;get renderer(){return this.#E}#x=0;get frameRendered(){return this.#x}#S=0;get frameSkipped(){return this.#S}#b;#T;#z;#U=!1;#D=0;constructor(e){this.#C=e,this.#E=document.createElement("canvas"),this.#b=this.#E.getContext("2d"),this.#T=new VideoDecoder({output:e=>{this.#U?this.#S+=1:(this.#U=!0,this.#x+=1),this.#b.drawImage(e,0,0),e.close()},error(e){}}),this.#k=new a.WritableStream({write:e=>{switch(e.type){case"configuration":this.#N(e.data);break;case"data":this.#P(e)}}}),this.#W()}#W=()=>{this.#U=!1,this.#D=requestAnimationFrame(this.#W)};#N(e){switch(this.#C){case r.WP.H264:{let{profileIndex:t,constraintSet:i,levelIndex:a,croppedWidth:n,croppedHeight:o}=(0,r.VM)(e);this.#E.width=n,this.#E.height=o;let l=`avc1.${[t,i,a].map(s).join("")}`;this.#T.configure({codec:l,optimizeForLatency:!0});break}case r.WP.H265:{let{generalProfileSpace:t,generalProfileIndex:i,generalProfileCompatibilitySet:a,generalTierFlag:s,generalLevelIndex:o,generalConstraintSet:l,croppedWidth:d,croppedHeight:c}=(0,r.hA)(e);this.#E.width=d,this.#E.height=c;let h=["hev1",["","A","B","C"][t]+i.toString(),n(a,0).toString(16),(s?"H":"L")+o.toString(),n(l,0).toString(16).toUpperCase(),n(l,4).toString(16).toUpperCase()].join(".");this.#T.configure({codec:h,optimizeForLatency:!0})}}this.#z=e}#P(e){let t;"configured"===this.#T.state&&(void 0!==this.#z?((t=new Uint8Array(this.#z.byteLength+e.data.byteLength)).set(this.#z,0),t.set(e.data,this.#z.byteLength),this.#z=void 0):t=e.data,this.#T.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:t})))}dispose(){cancelAnimationFrame(this.#D),"closed"!==this.#T.state&&this.#T.close()}}},6341:function(e,t,i){function*r(e){let t=-1,i=0,r=!1;for(let a=0;a<e.length;a+=1){let s=e[a];if(r){if(s>3)throw Error("Invalid data");r=!1;continue}if(0===s){i+=1;continue}let n=i;if(i=0,-1===t){if(n>=2&&1===s){t=a+1;continue}throw Error("Invalid data")}if(!(n<2)){if(1===s){yield e.subarray(t,a-n),t=a+1;continue}if(n>2)throw Error("Invalid data");switch(s){case 2:throw Error("Invalid data");case 3:r=!0}}}if(r)throw Error("Invalid data");yield e.subarray(t,e.length)}i.d(t,{Nm:function(){return F},vo:function(){return O},AY:function(){return j},vH:function(){return G},OV:function(){return K},DC:function(){return R},Zj:function(){return B},Mr:function(){return Z},P3:function(){return ef},K1:function(){return ex},$e:function(){return eE},aA:function(){return ed},lq:function(){return eu},L5:function(){return $},iX:function(){return er},Kn:function(){return e$},VE:function(){return eY},nW:function(){return ek},qq:function(){return eJ},YF:function(){return H},WP:function(){return Y},J4:function(){return eQ},qC:function(){return r},uZ:function(){return em},VM:function(){return n},MN:function(){return s},hA:function(){return p},tW:function(){return l},r_:function(){return o},mc:function(){return u}}),(N=P||(P={}))[N.Main8=1]="Main8",N[N.Main10=2]="Main10",N[N.Main10Hdr10=4096]="Main10Hdr10",N[N.Main10Hdr10Plus=8192]="Main10Hdr10Plus",(C=W||(W={}))[C.Level2=1]="Level2",C[C.Level21=2]="Level21",C[C.Level22=4]="Level22",C[C.Level23=8]="Level23",C[C.Level3=16]="Level3",C[C.Level31=32]="Level31",C[C.Level32=64]="Level32",C[C.Level33=128]="Level33",C[C.Level4=256]="Level4",C[C.Level41=512]="Level41",C[C.Level42=1024]="Level42",C[C.Level43=2048]="Level43",C[C.Level5=4096]="Level5",C[C.Level51=8192]="Level51",C[C.Level52=16384]="Level52",C[C.Level53=32768]="Level53",C[C.Level6=65536]="Level6",C[C.Level61=131072]="Level61",C[C.Level62=262144]="Level62",C[C.Level63=524288]="Level63",C[C.Level7=1048576]="Level7",C[C.Level71=2097152]="Level71",C[C.Level72=4194304]="Level72",C[C.Level73=8388608]="Level73";class a{#O;#F;#I;#_=0;#R=-1;#B=-1;#H=0;get byteLength(){return this.#F}get stopBitIndex(){return this.#I}get bytePosition(){return this.#R}get bitPosition(){return this.#B}get ended(){return this.#R===this.#F&&this.#B===this.#I}constructor(e){this.#O=e;for(let t=e.length-1;t>=0;t-=1){if(0===this.#O[t])continue;let i=e[t];for(let e=0;e<8;e+=1)if((i>>e&1)==1){this.#F=t,this.#I=e,this.#V();return}}throw Error("Stop bit not found")}#V(){if(this.#H=this.#O[this.#R],2===this.#_&&3===this.#H){this.#_=0,this.#R+=1,this.#V();return}0===this.#H?this.#_+=1:this.#_=0}next(){if(-1===this.#B&&(this.#B=7,this.#R+=1,this.#V()),this.ended)throw Error("Bit index out of bounds");let e=this.#H>>this.#B&1;return this.#B-=1,e}read(e){if(e>32)throw Error("Read length too large");let t=0;for(let i=0;i<e;i+=1)t=t<<1|this.next();return t}skip(e){for(let t=0;t<e;t+=1)this.next()}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}#G(){return{zeroCount:this.#_,bytePosition:this.#R,bitPosition:this.#B,byte:this.#H}}#K(e){this.#_=e.zeroCount,this.#R=e.bytePosition,this.#B=e.bitPosition,this.#H=e.byte}peek(e){let t=this.#G(),i=this.read(e);return this.#K(t),i}readBytes(e){let t=new Uint8Array(e);for(let i=0;i<e;i+=1)t[i]=this.read(8);return t}peekBytes(e){let t=this.#G(),i=this.readBytes(e);return this.#K(t),i}}function s(e){let t,i;for(let a of r(e)){let e=31&a[0];switch(e){case 7:if(t=a,i)return{sequenceParameterSet:t,pictureParameterSet:i};break;case 8:if(i=a,t)return{sequenceParameterSet:t,pictureParameterSet:i}}}throw Error("Invalid data")}function n(e){let{sequenceParameterSet:t,pictureParameterSet:i}=s(e),{profile_idc:r,constraint_set:n,level_idc:o,pic_width_in_mbs_minus1:l,pic_height_in_map_units_minus1:d,frame_mbs_only_flag:c,frame_crop_left_offset:h,frame_crop_right_offset:u,frame_crop_top_offset:p,frame_crop_bottom_offset:f}=function(e){let t,i,r,s;let n=new a(e);if(0!==n.next())throw Error("Invalid data");let o=n.read(2),l=n.read(5);if(7!==l||0===o)throw Error("Invalid data");let d=n.read(8),c=n.peek(8),h=!!n.next(),u=!!n.next(),p=!!n.next(),f=!!n.next(),m=!!n.next(),w=!!n.next();if(0!==n.read(2))throw Error("Invalid data");let b=n.read(8),v=n.decodeExponentialGolombNumber();if(100===d||110===d||122===d||244===d||44===d||83===d||86===d||118===d||128===d||138===d||139===d||134===d){let e=n.decodeExponentialGolombNumber();3===e&&n.next(),n.decodeExponentialGolombNumber(),n.decodeExponentialGolombNumber(),n.next();let t=!!n.next();if(t){let t=[];for(let i=0;i<(3!==e?8:12);i+=1)t[i]=!!n.next(),t[i]}}n.decodeExponentialGolombNumber();let g=n.decodeExponentialGolombNumber();if(0===g)n.decodeExponentialGolombNumber();else if(1===g){n.next(),n.decodeExponentialGolombNumber(),n.decodeExponentialGolombNumber();let e=n.decodeExponentialGolombNumber(),t=[];for(let i=0;i<e;i+=1)t[i]=n.decodeExponentialGolombNumber()}n.decodeExponentialGolombNumber(),n.next();let y=n.decodeExponentialGolombNumber(),L=n.decodeExponentialGolombNumber(),E=n.next();E||n.next(),n.next();let x=!!n.next();return x?(t=n.decodeExponentialGolombNumber(),i=n.decodeExponentialGolombNumber(),r=n.decodeExponentialGolombNumber(),s=n.decodeExponentialGolombNumber()):(t=0,i=0,r=0,s=0),n.next(),{profile_idc:d,constraint_set:c,constraint_set0_flag:h,constraint_set1_flag:u,constraint_set2_flag:p,constraint_set3_flag:f,constraint_set4_flag:m,constraint_set5_flag:w,level_idc:b,seq_parameter_set_id:v,pic_width_in_mbs_minus1:y,pic_height_in_map_units_minus1:L,frame_mbs_only_flag:E,frame_cropping_flag:x,frame_crop_left_offset:t,frame_crop_right_offset:i,frame_crop_top_offset:r,frame_crop_bottom_offset:s}}(t),m=(l+1)*16,w=(d+1)*(2-c)*16,b=2*h,v=2*u,g=2*p,y=2*f;return{pictureParameterSet:i,sequenceParameterSet:t,profileIndex:r,constraintSet:n,levelIndex:o,encodedWidth:m,encodedHeight:w,cropLeft:b,cropRight:v,cropTop:g,cropBottom:y,croppedWidth:m-b-v,croppedHeight:w-g-y}}function o(e){let t,i,r,s,n,o,l,d;let u=new a(e),p=u.read(4),f=!!u.next(),m=!!u.next(),w=u.read(6),b=u.read(3),v=!!u.next();u.skip(16);let g=c(u,!0,b),y=!!u.next(),L=[],E=[],x=[];for(let e=y?0:b;e<=b;e+=1)L[e]=u.decodeExponentialGolombNumber(),E[e]=u.decodeExponentialGolombNumber(),x[e]=u.decodeExponentialGolombNumber();let S=u.read(6),k=u.decodeExponentialGolombNumber(),M=[];for(let e=1;e<=k;e+=1){M[e]=[];for(let t=0;t<=S;t+=1)M[e][t]=!!u.next()}let A=!!u.next();if(A){t=u.read(32),i=u.read(32),(r=!!u.next())&&(s=u.decodeExponentialGolombNumber()),n=u.decodeExponentialGolombNumber(),o=[],l=[!0],d=[];for(let e=0;e<n;e+=1)o[e]=u.decodeExponentialGolombNumber(),e>0&&(l[e]=!!u.next()),d[e]=function(e,t,i){let r,a,s,n,o,l,d,c,u,p,f,m,w;t&&(r=!!e.next(),a=!!e.next(),(r||a)&&((s=!!e.next())&&(n=e.read(8),o=e.read(5),l=!!e.next(),d=e.read(5)),c=e.read(4),u=e.read(4),s&&(p=e.read(4)),f=e.read(5),m=e.read(5),w=e.read(5)));let b=[],v=[],g=[],y=[],L=[],E=[],x=[];for(let t=0;t<=i;t+=1){var S,k;b[t]=!!e.next(),b[t]||(v[t]=!!e.next()),v[t]?g[t]=e.decodeExponentialGolombNumber():y[t]=!!e.next(),y[t]||(L[t]=e.decodeExponentialGolombNumber()),r&&(E[t]=h(e,t,(S=L[t])+1)),a&&(x[t]=h(e,t,(k=L[t])+1))}return{nal_hrd_parameters_present_flag:r,vcl_hrd_parameters_present_flag:a,sub_pic_hrd_params_present_flag:s,tick_divisor_minus2:n,du_cpb_removal_delay_increment_length_minus1:o,sub_pic_cpb_params_in_pic_timing_sei_flag:l,dpb_output_delay_du_length_minus1:d,bit_rate_scale:c,cpb_size_scale:u,cpb_size_du_scale:p,initial_cpb_removal_delay_length_minus1:f,au_cpb_removal_delay_length_minus1:m,dpb_output_delay_length_minus1:w,fixed_pic_rate_general_flag:b,fixed_pic_rate_within_cvs_flag:v,elemental_duration_in_tc_minus1:g,low_delay_hrd_flag:y,cpb_cnt_minus1:L,nalHrdParameters:E,vclHrdParameters:x}}(u,l[e],b)}let N=!!u.next();return{vps_video_parameter_set_id:p,vps_base_layer_internal_flag:f,vps_base_layer_available_flag:m,vps_max_layers_minus1:w,vps_max_sub_layers_minus1:b,vps_temporal_id_nesting_flag:v,profileTierLevel:g,vps_sub_layer_ordering_info_present_flag:y,vps_max_dec_pic_buffering_minus1:L,vps_max_num_reorder_pics:E,vps_max_latency_increase_plus1:x,vps_max_layer_id:S,vps_num_layer_sets_minus1:k,layer_id_included_flag:M,vps_timing_info_present_flag:A,vps_num_units_in_tick:t,vps_time_scale:i,vps_poc_proportional_to_timing_flag:r,vps_num_ticks_poc_diff_one_minus1:s,vps_num_hrd_parameters:n,hrd_layer_set_idx:o,cprms_present_flag:l,hrdParameters:d,vps_extension_flag:N}}function l(e){let t,i,r,s,n,o,l,d,h,u,p,f,m,w,b,v,g,y,L,E,x,S,k,M,A,N,C;let T=new a(e),z=T.read(4),U=T.read(3),D=!!T.next(),P=c(T,!0,U),W=T.decodeExponentialGolombNumber(),O=T.decodeExponentialGolombNumber();3===O&&(t=!!T.next());let F=T.decodeExponentialGolombNumber(),I=T.decodeExponentialGolombNumber(),_=!!T.next();_&&(i=T.decodeExponentialGolombNumber(),r=T.decodeExponentialGolombNumber(),s=T.decodeExponentialGolombNumber(),n=T.decodeExponentialGolombNumber());let R=T.decodeExponentialGolombNumber(),B=T.decodeExponentialGolombNumber(),H=T.decodeExponentialGolombNumber(),V=!!T.next();for(let e=V?0:U;e<=U;e+=1){o=[],l=[],d=[];for(let e=0;e<=U;e+=1)o[e]=T.decodeExponentialGolombNumber(),l[e]=T.decodeExponentialGolombNumber(),d[e]=T.decodeExponentialGolombNumber()}let G=T.decodeExponentialGolombNumber(),K=T.decodeExponentialGolombNumber(),j=T.decodeExponentialGolombNumber(),Z=T.decodeExponentialGolombNumber(),$=T.decodeExponentialGolombNumber(),q=T.decodeExponentialGolombNumber(),X=!!T.next();X&&(h=!!T.next())&&(u=function(e){let t=[];for(let i=0;i<4;i+=1){t[i]=[];for(let r=0;r<6;r+=3===i?3:1){let a=!!e.next();if(a){let a=8,s=Math.min(64,1<<4+(i<<1));if(i>1){let t=e.decodeExponentialGolombNumber();a=t+8}t[i][r]=[];for(let n=0;n<s;n+=1){let s=e.decodeExponentialGolombNumber();a=(a+s+256)%256,t[i][r][n]=a}}else e.decodeExponentialGolombNumber()}}return t}(T));let Y=!!T.next(),Q=!!T.next(),J=!!T.next();J&&(p=T.read(4),f=T.read(4),m=T.read(4),w=T.read(4),b=!!T.next());let ee=T.decodeExponentialGolombNumber(),et=[];for(let e=0;e<ee;e+=1)et[e]=function(e,t,i,r){let a=!1;0!==t&&(a=!!e.next());let s=0,n=!1,o=0,l=[],d=[],c=0,h=0,u=[],p=[],f=[],m=[];if(a){t===i&&(s=e.decodeExponentialGolombNumber()),n=!!e.next(),o=e.decodeExponentialGolombNumber();let a=t-(s+1),w=r[a],b=w.num_negative_pics+w.num_positive_pics;for(let t=0;t<=b;t+=1)l[t]=!!e.next(),l[t]?d[t]=!0:d[t]=!!e.next();let v=(1-2*Number(n))*(o+1),g=[],y=[],L=[],E=[],x=0;for(let e=0;e<w.num_negative_pics;e+=1)x-=w.delta_poc_s0_minus1[e]+1,g[e]=x;x=0;for(let e=0;e<w.num_positive_pics;e+=1)x+=w.delta_poc_s1_minus1[e]+1,y[e]=x;let S=0;if(w.num_positive_pics>0)for(let e=w.num_positive_pics-1;e>=0;e-=1)(x=y[e]+v)<0&&d[w.num_negative_pics+e]&&(L[S]=x,p[S]=l[w.num_negative_pics+e],S+=1);v<0&&d[b]&&(L[S]=v,p[S]=l[b],S+=1);for(let e=0;e<w.num_negative_pics;e+=1)(x=g[e]+v)<0&&d[e]&&(L[S]=x,p[S]=l[e],S+=1);c=S;let k=0;for(S=0;S<c;S+=1){let e=L[S];u[S]=-(e-k-1),k=e}if(S=0,w.num_negative_pics>0)for(let e=w.num_negative_pics-1;e>=0;e-=1)(x=g[e]+v)>0&&d[e]&&(E[S]=x,m[S]=l[e],S+=1);v>0&&d[b]&&(E[S]=v,m[S]=l[b],S+=1);for(let e=0;e<w.num_positive_pics;e+=1)(x=y[e]+v)>0&&d[w.num_negative_pics+e]&&(E[S]=x,m[S]=l[w.num_negative_pics+e],S+=1);for(h=S,k=0,S=0;S<h;S+=1){let e=E[S];f[S]=e-k-1,k=e}}else{c=e.decodeExponentialGolombNumber(),h=e.decodeExponentialGolombNumber();for(let t=0;t<c;t+=1)u[t]=e.decodeExponentialGolombNumber(),p[t]=!!e.next();for(let t=0;t<h;t+=1)f[t]=e.decodeExponentialGolombNumber(),m[t]=!!e.next()}return{stRpsIdx:t,num_short_term_ref_pic_sets:i,inter_ref_pic_set_prediction_flag:a,delta_idx_minus1:s,delta_rps_sign:n,abs_delta_rps_minus1:o,used_by_curr_pic_flag:l,use_delta_flag:d,num_negative_pics:c,num_positive_pics:h,delta_poc_s0_minus1:u,used_by_curr_pic_s0_flag:p,delta_poc_s1_minus1:f,used_by_curr_pic_s1_flag:m}}(T,e,ee,et);let ei=!!T.next();if(ei){v=T.decodeExponentialGolombNumber(),g=[],y=[];for(let e=0;e<v;e+=1)g[e]=T.read(H+4),y[e]=!!T.next()}let er=!!T.next(),ea=!!T.next(),es=!!T.next();es&&(L=function(e){let t,i,r,a,s,n,o,l,d,c,h,u,p,f,m,w,b,v,g,y,L,E,x,S,k,M,A,N,C;let T=!!e.next();T&&255===(t=e.read(8))&&(i=e.read(16),r=e.read(16));let z=!!e.next();z&&(a=!!e.next());let U=!!e.next();U&&(s=e.read(3),n=!!e.next(),(o=!!e.next())&&(l=e.read(8),d=e.read(8),c=e.read(8)));let D=!!e.next();D&&(h=e.decodeExponentialGolombNumber(),u=e.decodeExponentialGolombNumber());let P=!!e.next(),W=!!e.next(),O=!!e.next(),F=!!e.next();F&&(p=e.decodeExponentialGolombNumber(),f=e.decodeExponentialGolombNumber(),m=e.decodeExponentialGolombNumber(),w=e.decodeExponentialGolombNumber());let I=!!e.next();if(I&&(b=e.read(32),v=e.read(32),(g=!!e.next())&&(y=e.decodeExponentialGolombNumber()),L=!!e.next()))throw Error("Not implemented");let _=!!e.next();return _&&(E=!!e.next(),x=!!e.next(),S=!!e.next(),k=e.decodeExponentialGolombNumber(),M=e.decodeExponentialGolombNumber(),A=e.decodeExponentialGolombNumber(),N=e.decodeExponentialGolombNumber(),C=e.decodeExponentialGolombNumber()),{aspect_ratio_info_present_flag:T,aspect_ratio_idc:t,sar_width:i,sar_height:r,overscan_info_present_flag:z,overscan_appropriate_flag:a,video_signal_type_present_flag:U,video_format:s,video_full_range_flag:n,colour_description_present_flag:o,colour_primaries:l,transfer_characteristics:d,matrix_coeffs:c,chroma_loc_info_present_flag:D,chroma_sample_loc_type_top_field:h,chroma_sample_loc_type_bottom_field:u,neutral_chroma_indication_flag:P,field_seq_flag:W,frame_field_info_present_flag:O,default_display_window_flag:F,def_disp_win_left_offset:p,def_disp_win_right_offset:f,def_disp_win_top_offset:m,def_disp_win_bottom_offset:w,vui_timing_info_present_flag:I,vui_num_units_in_tick:b,vui_time_scale:v,vui_poc_proportional_to_timing_flag:g,vui_num_ticks_poc_diff_one_minus1:y,vui_hrd_parameters_present_flag:L,bitstream_restriction_flag:_,tiles_fixed_structure_flag:E,motion_vectors_over_pic_boundaries_flag:x,restricted_ref_pic_lists_flag:S,min_spatial_segmentation_idc:k,max_bytes_per_pic_denom:M,max_bits_per_min_cu_denom:A,log2_max_mv_length_horizontal:N,log2_max_mv_length_vertical:C}}(T));let en=!!T.next();if(en&&(E=!!T.next(),x=!!T.next(),S=!!T.next(),k=!!T.next(),M=T.read(4)),E||(x&&(A=function(e){let t=!!e.next();return{inter_view_mv_vert_constraint_flag:t}}(T)),S&&(N=function(e){let t=[],i=[];t[0]=!!e.next(),i[0]=!!e.next();let r=e.decodeExponentialGolombNumber(),a=!!e.next(),s=!!e.next(),n=!!e.next(),o=!!e.next();t[1]=!!e.next(),i[1]=!!e.next();let l=!!e.next(),d=e.decodeExponentialGolombNumber(),c=!!e.next(),h=!!e.next(),u=!!e.next(),p=!!e.next(),f=!!e.next();return{iv_di_mc_enabled_flag:t,iv_mv_scal_enabled_flag:i,log2_ivmc_sub_pb_size_minus3:r,iv_res_pred_enabled_flag:a,depth_ref_enabled_flag:s,vsp_mc_enabled_flag:n,dbbp_enabled_flag:o,tex_mc_enabled_flag:l,log2_texmc_sub_pb_size_minus3:d,intra_contour_enabled_flag:c,intra_dc_only_wedge_enabled_flag:h,cqt_cu_part_pred_enabled_flag:u,inter_dc_only_enabled_flag:p,skip_intra_enabled_flag:f}}(T)),k))throw Error("Not implemented");if(M){C=[];let e=0;for(;!T.ended;)C[e]=!!T.next(),e+=1}return{sps_video_parameter_set_id:z,sps_max_sub_layers_minus1:U,sps_temporal_id_nesting_flag:D,profileTierLevel:P,sps_seq_parameter_set_id:W,chroma_format_idc:O,separate_colour_plane_flag:t,pic_width_in_luma_samples:F,pic_height_in_luma_samples:I,conformance_window_flag:_,conf_win_left_offset:i,conf_win_right_offset:r,conf_win_top_offset:s,conf_win_bottom_offset:n,bit_depth_luma_minus8:R,bit_depth_chroma_minus8:B,log2_max_pic_order_cnt_lsb_minus4:H,sps_sub_layer_ordering_info_present_flag:V,sps_max_dec_pic_buffering_minus1:o,sps_max_num_reorder_pics:l,sps_max_latency_increase_plus1:d,log2_min_luma_coding_block_size_minus3:G,log2_diff_max_min_luma_coding_block_size:K,log2_min_luma_transform_block_size_minus2:j,log2_diff_max_min_luma_transform_block_size:Z,max_transform_hierarchy_depth_inter:$,max_transform_hierarchy_depth_intra:q,scaling_list_enabled_flag:X,sps_scaling_list_data_present_flag:h,scalingListData:u,amp_enabled_flag:Y,sample_adaptive_offset_enabled_flag:Q,pcm_enabled_flag:J,pcm_sample_bit_depth_luma_minus1:p,pcm_sample_bit_depth_chroma_minus1:f,log2_min_pcm_luma_coding_block_size_minus3:m,log2_diff_max_min_pcm_luma_coding_block_size:w,pcm_loop_filter_disabled_flag:b,num_short_term_ref_pic_sets:ee,shortTermRefPicSets:et,long_term_ref_pics_present_flag:ei,num_long_term_ref_pics_sps:v,lt_ref_pic_poc_lsb_sps:g,used_by_curr_pic_lt_sps_flag:y,sps_temporal_mvp_enabled_flag:er,strong_intra_smoothing_enabled_flag:ea,vui_parameters_present_flag:es,vuiParameters:L,sps_extension_present_flag:en,sps_range_extension_flag:E,sps_multilayer_extension_flag:x,sps_3d_extension_flag:S,sps_scc_extension_flag:k,sps_extension_4bits:M,spsMultilayerExtension:A,sps3dExtension:N,sps_extension_data_flag:C}}function d(e){let t,i,r,a,s,n,o,l,d,c,h;let u=e.read(2),p=!!e.next(),f=e.read(5),m=e.peekBytes(4),w=[];for(let t=0;t<32;t+=1)w[t]=!!e.next();let b=e.peekBytes(6),v=!!e.next(),g=!!e.next(),y=!!e.next(),L=!!e.next();return 4===f||w[4]||5===f||w[5]||6===f||w[6]||7===f||w[7]||8===f||w[8]||9===f||w[9]||10===f||w[10]||11===f||w[11]?(t=!!e.next(),i=!!e.next(),r=!!e.next(),a=!!e.next(),s=!!e.next(),n=!!e.next(),o=!!e.next(),l=!!e.next(),d=!!e.next(),5===f||w[5]||9===f||w[9]||10===f||w[10]||11===f||w[11]?(c=!!e.next(),e.skip(33)):e.skip(34)):2===f||w[2]?(e.skip(7),l=!!e.next(),e.skip(35)):e.skip(43),1===f||w[1]||2===f||w[2]||3===f||w[3]||4===f||w[4]||5===f||w[5]||9===f||w[9]||11===f||w[11]?h=!!e.next():e.skip(1),{profile_space:u,tier_flag:p,profile_idc:f,profileCompatibilitySet:m,profile_compatibility_flag:w,constraintSet:b,progressive_source_flag:v,interlaced_source_flag:g,non_packed_constraint_flag:y,frame_only_constraint_flag:L,max_12bit_constraint_flag:t,max_10bit_constraint_flag:i,max_8bit_constraint_flag:r,max_422chroma_constraint_flag:a,max_420chroma_constraint_flag:s,max_monochrome_constraint_flag:n,intra_constraint_flag:o,one_picture_only_constraint_flag:l,lower_bit_rate_constraint_flag:d,max_14bit_constraint_flag:c,inbld_flag:h}}function c(e,t,i){let r;t&&(r=d(e));let a=e.read(8),s=[],n=[];for(let t=0;t<i;t+=1)s[t]=!!e.next(),n[t]=!!e.next();if(i>0)for(let t=i;t<8;t+=1)e.read(2);let o=[],l=[];for(let t=0;t<i;t+=1)s[t]&&(o[t]=d(e)),n[t]&&(l[t]=e.read(8));return{generalProfileTier:r,general_level_idc:a,sub_layer_profile_present_flag:s,sub_layer_level_present_flag:n,subLayerProfileTier:o,sub_layer_level_idc:l}}function h(e,t,i){let r=[],a=[],s=[];for(let n=0;n<i;n+=1)r[n]=e.decodeExponentialGolombNumber(),a[n]=e.decodeExponentialGolombNumber(),t>0&&(s[n]=!!e.next());return{bit_rate_value_minus1:r,cpb_size_value_minus1:a,cpb_size_du_value_minus1:[],bit_rate_du_value_minus1:[],cbr_flag:s}}function u(e){let t,i,s;let n=0;for(let o of r(e)){let e=function(e){let t=new a(e);if(0!==t.next())throw Error("Invalid NALU header");let i=t.read(6),r=t.read(6),s=t.read(3);return{nal_unit_type:i,nuh_layer_id:r,nuh_temporal_id_plus1:s}}(o),r={...e,data:o,rbsp:o.subarray(2)};switch(e.nal_unit_type){case 32:t=r;break;case 33:i=r;break;case 34:s=r;break;default:continue}if(3===(n+=1))return{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:s}}throw Error("Invalid data")}function p(e){let{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}=u(e),{profileTierLevel:{generalProfileTier:{profile_space:a,tier_flag:s,profile_idc:n,profileCompatibilitySet:d,constraintSet:c},general_level_idc:h}}=o(t.rbsp),{chroma_format_idc:p,pic_width_in_luma_samples:f,pic_height_in_luma_samples:m,conf_win_left_offset:w=0,conf_win_right_offset:b=0,conf_win_top_offset:v=0,conf_win_bottom_offset:g=0}=l(i.rbsp),y=function(e){switch(e){case 0:case 3:return 1;case 1:case 2:return 2;default:throw Error("Invalid chroma_format_idc")}}(p),L=function(e){switch(e){case 0:case 2:case 3:return 1;case 1:return 2;default:throw Error("Invalid chroma_format_idc")}}(p);return{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r,generalProfileSpace:a,generalProfileIndex:n,generalProfileCompatibilitySet:d,generalTierFlag:s,generalLevelIndex:h,generalConstraintSet:c,encodedWidth:f,encodedHeight:m,cropLeft:w,cropRight:b,cropTop:v,cropBottom:g,croppedWidth:f-y*(w+b),croppedHeight:m-L*(v+g)}}(T=O||(O={}))[T.Baseline=1]="Baseline",T[T.Main=2]="Main",T[T.Extended=4]="Extended",T[T.High=8]="High",T[T.High10=16]="High10",T[T.High422=32]="High422",T[T.High444=64]="High444",T[T.ConstrainedBaseline=65536]="ConstrainedBaseline",T[T.ConstrainedHigh=524288]="ConstrainedHigh",(z=F||(F={}))[z.Level1=1]="Level1",z[z.Level1b=2]="Level1b",z[z.Level11=4]="Level11",z[z.Level12=8]="Level12",z[z.Level13=16]="Level13",z[z.Level2=32]="Level2",z[z.Level21=64]="Level21",z[z.Level22=128]="Level22",z[z.Level3=256]="Level3",z[z.Level31=512]="Level31",z[z.Level32=1024]="Level32",z[z.Level4=2048]="Level4",z[z.Level41=4096]="Level41",z[z.Level42=8192]="Level42",z[z.Level5=16384]="Level5",z[z.Level51=32768]="Level51",z[z.Level52=65536]="Level52",z[z.Level6=131072]="Level6",z[z.Level61=262144]="Level61",z[z.Level62=524288]="Level62",(U=I||(I={}))[U.Main=1]="Main",U[U.Main10=2]="Main10",U[U.MainStill=4]="MainStill",U[U.Main10Hdr10=4096]="Main10Hdr10",U[U.Main10Hdr10Plus=8192]="Main10Hdr10Plus",(D=_||(_={}))[D.MainTierLevel1=1]="MainTierLevel1",D[D.HighTierLevel1=2]="HighTierLevel1",D[D.MainTierLevel2=4]="MainTierLevel2",D[D.HighTierLevel2=8]="HighTierLevel2",D[D.MainTierLevel21=16]="MainTierLevel21",D[D.HighTierLevel21=32]="HighTierLevel21",D[D.MainTierLevel3=64]="MainTierLevel3",D[D.HighTierLevel3=128]="HighTierLevel3",D[D.MainTierLevel31=256]="MainTierLevel31",D[D.HighTierLevel31=512]="HighTierLevel31",D[D.MainTierLevel4=1024]="MainTierLevel4",D[D.HighTierLevel4=2048]="HighTierLevel4",D[D.MainTierLevel41=4096]="MainTierLevel41",D[D.HighTierLevel41=8192]="HighTierLevel41",D[D.MainTierLevel5=16384]="MainTierLevel5",D[D.HighTierLevel5=32768]="HighTierLevel5",D[D.MainTierLevel51=65536]="MainTierLevel51",D[D.HighTierLevel51=131072]="HighTierLevel51",D[D.MainTierLevel52=262144]="MainTierLevel52",D[D.HighTierLevel52=524288]="HighTierLevel52",D[D.MainTierLevel6=1048576]="MainTierLevel6",D[D.HighTierLevel6=2097152]="HighTierLevel6",D[D.MainTierLevel61=4194304]="MainTierLevel61",D[D.HighTierLevel61=8388608]="HighTierLevel61",D[D.MainTierLevel62=16777216]="MainTierLevel62",D[D.HighTierLevel62=33554432]="HighTierLevel62";var f,m,w,b,v,g,y,L,E,x,S,k,M,A,N,C,T,z,U,D,P,W,O,F,I,_,R,B,H,V,G,K,j,Z,$,q,X,Y,Q,J,ee=i(4185);let et=new ee.AU().uint8("type");(f=R||(R={}))[f.Down=0]="Down",f[f.Up=1]="Up",f[f.Move=2]="Move",f[f.Cancel=3]="Cancel",f[f.Outside=4]="Outside",f[f.PointerDown=5]="PointerDown",f[f.PointerUp=6]="PointerUp",f[f.HoverMove=7]="HoverMove",f[f.Scroll=8]="Scroll",f[f.HoverEnter=9]="HoverEnter",f[f.HoverExit=10]="HoverExit",f[f.ButtonPress=11]="ButtonPress",f[f.ButtonRelease=12]="ButtonRelease",(m=B||(B={}))[m.Primary=1]="Primary",m[m.Secondary=2]="Secondary",m[m.Tertiary=4]="Tertiary",m[m.Back=8]="Back",m[m.Forward=16]="Forward",m[m.StylusPrimary=32]="StylusPrimary",m[m.StylusSecondary=64]="StylusSecondary",(w=H||(H={})).Mouse=-1n,w.Finger=-2n,w.VirtualMouse=-3n,w.VirtualFinger=-4n,(b=V||(V={}))[b.InjectKeyCode=0]="InjectKeyCode",b[b.InjectText=1]="InjectText",b[b.InjectTouch=2]="InjectTouch",b[b.InjectScroll=3]="InjectScroll",b[b.BackOrScreenOn=4]="BackOrScreenOn",b[b.ExpandNotificationPanel=5]="ExpandNotificationPanel",b[b.ExpandSettingPanel=6]="ExpandSettingPanel",b[b.CollapseNotificationPanel=7]="CollapseNotificationPanel",b[b.GetClipboard=8]="GetClipboard",b[b.SetClipboard=9]="SetClipboard",b[b.SetScreenPowerMode=10]="SetScreenPowerMode",b[b.RotateDevice=11]="RotateDevice";class ei{#j;constructor(e){this.#j=e.controlMessageTypes}get(e){let t=this.#j.indexOf(e);if(-1===t)throw Error("Not supported");return t}fillMessageType(e,t){return e.type=this.get(t),e}}class er{#Z;process(e){let t=[];return this.#Z&&this.#Z.pointerId!==e.pointerId&&(t.push({...this.#Z,action:R.Up}),this.#Z=void 0),e.action===R.HoverMove&&(this.#Z=e),e.type=V.InjectTouch,t.push(e),t}}(v=G||(G={}))[v.Down=0]="Down",v[v.Up=1]="Up",(g=K||(K={}))[g.AltOn=2]="AltOn",g[g.AltLeftOn=16]="AltLeftOn",g[g.AltRightOn=32]="AltRightOn",g[g.ShiftOn=1]="ShiftOn",g[g.ShiftLeftOn=64]="ShiftLeftOn",g[g.ShiftRightOn=128]="ShiftRightOn",g[g.CtrlOn=4096]="CtrlOn",g[g.CtrlLeftOn=8192]="CtrlLeftOn",g[g.CtrlRightOn=16384]="CtrlRightOn",g[g.MetaOn=65536]="MetaOn",g[g.MetaLeftOn=131072]="MetaLeftOn",g[g.MetaRightOn=262144]="MetaRightOn",g[g.CapsLockOn=1048576]="CapsLockOn",g[g.NumLockOn=2097152]="NumLockOn",g[g.ScrollLockOn=4194304]="ScrollLockOn",(y=j||(j={}))[y.AndroidHome=3]="AndroidHome",y[y.AndroidBack=4]="AndroidBack",y[y.AndroidCall=5]="AndroidCall",y[y.AndroidEndCall=6]="AndroidEndCall",y[y.Digit0=7]="Digit0",y[y.Digit1=8]="Digit1",y[y.Digit2=9]="Digit2",y[y.Digit3=10]="Digit3",y[y.Digit4=11]="Digit4",y[y.Digit5=12]="Digit5",y[y.Digit6=13]="Digit6",y[y.Digit7=14]="Digit7",y[y.Digit8=15]="Digit8",y[y.Digit9=16]="Digit9",y[y.Star=17]="Star",y[y.Pound=18]="Pound",y[y.ArrowUp=19]="ArrowUp",y[y.ArrowDown=20]="ArrowDown",y[y.ArrowLeft=21]="ArrowLeft",y[y.ArrowRight=22]="ArrowRight",y[y.AndroidDPadCenter=23]="AndroidDPadCenter",y[y.VolumeUp=24]="VolumeUp",y[y.VolumeDown=25]="VolumeDown",y[y.Power=26]="Power",y[y.AndroidCamera=27]="AndroidCamera",y[y.Clear=28]="Clear",y[y.KeyA=29]="KeyA",y[y.KeyB=30]="KeyB",y[y.KeyC=31]="KeyC",y[y.KeyD=32]="KeyD",y[y.KeyE=33]="KeyE",y[y.KeyF=34]="KeyF",y[y.KeyG=35]="KeyG",y[y.KeyH=36]="KeyH",y[y.KeyI=37]="KeyI",y[y.KeyJ=38]="KeyJ",y[y.KeyK=39]="KeyK",y[y.KeyL=40]="KeyL",y[y.KeyM=41]="KeyM",y[y.KeyN=42]="KeyN",y[y.KeyO=43]="KeyO",y[y.KeyP=44]="KeyP",y[y.KeyQ=45]="KeyQ",y[y.KeyR=46]="KeyR",y[y.KeyS=47]="KeyS",y[y.KeyT=48]="KeyT",y[y.KeyU=49]="KeyU",y[y.KeyV=50]="KeyV",y[y.KeyW=51]="KeyW",y[y.KeyX=52]="KeyX",y[y.KeyY=53]="KeyY",y[y.KeyZ=54]="KeyZ",y[y.Comma=55]="Comma",y[y.Period=56]="Period",y[y.AltLeft=57]="AltLeft",y[y.AltRight=58]="AltRight",y[y.ShiftLeft=59]="ShiftLeft",y[y.ShiftRight=60]="ShiftRight",y[y.Tab=61]="Tab",y[y.Space=62]="Space",y[y.AndroidSymbol=63]="AndroidSymbol",y[y.AndroidExplorer=64]="AndroidExplorer",y[y.AndroidEnvelope=65]="AndroidEnvelope",y[y.Enter=66]="Enter",y[y.Backspace=67]="Backspace",y[y.Backquote=68]="Backquote",y[y.Minus=69]="Minus",y[y.Equal=70]="Equal",y[y.BracketLeft=71]="BracketLeft",y[y.BracketRight=72]="BracketRight",y[y.Backslash=73]="Backslash",y[y.Semicolon=74]="Semicolon",y[y.Quote=75]="Quote",y[y.Slash=76]="Slash",y[y.At=77]="At",y[y.AndroidNum=78]="AndroidNum",y[y.AndroidHeadsetHook=79]="AndroidHeadsetHook",y[y.AndroidFocus=80]="AndroidFocus",y[y.Plus=81]="Plus",y[y.ContextMenu=82]="ContextMenu",y[y.AndroidNotification=83]="AndroidNotification",y[y.AndroidSearch=84]="AndroidSearch",y[y.PageUp=92]="PageUp",y[y.PageDown=93]="PageDown",y[y.Escape=111]="Escape",y[y.Delete=112]="Delete",y[y.ControlLeft=113]="ControlLeft",y[y.ControlRight=114]="ControlRight",y[y.CapsLock=115]="CapsLock",y[y.ScrollLock=116]="ScrollLock",y[y.MetaLeft=117]="MetaLeft",y[y.MetaRight=118]="MetaRight",y[y.AndroidFunction=119]="AndroidFunction",y[y.PrintScreen=120]="PrintScreen",y[y.Pause=121]="Pause",y[y.Home=122]="Home",y[y.End=123]="End",y[y.Insert=124]="Insert",y[y.AndroidForward=125]="AndroidForward",y[y.F1=131]="F1",y[y.F2=132]="F2",y[y.F3=133]="F3",y[y.F4=134]="F4",y[y.F5=135]="F5",y[y.F6=136]="F6",y[y.F7=137]="F7",y[y.F8=138]="F8",y[y.F9=139]="F9",y[y.F10=140]="F10",y[y.F11=141]="F11",y[y.F12=142]="F12",y[y.NumLock=143]="NumLock",y[y.Numpad0=144]="Numpad0",y[y.Numpad1=145]="Numpad1",y[y.Numpad2=146]="Numpad2",y[y.Numpad3=147]="Numpad3",y[y.Numpad4=148]="Numpad4",y[y.Numpad5=149]="Numpad5",y[y.Numpad6=150]="Numpad6",y[y.Numpad7=151]="Numpad7",y[y.Numpad8=152]="Numpad8",y[y.Numpad9=153]="Numpad9",y[y.NumpadDivide=154]="NumpadDivide",y[y.NumpadMultiply=155]="NumpadMultiply",y[y.NumpadSubtract=156]="NumpadSubtract",y[y.NumpadAdd=157]="NumpadAdd",y[y.NumpadDecimal=158]="NumpadDecimal",y[y.NumpadComma=159]="NumpadComma",y[y.NumpadEnter=160]="NumpadEnter",y[y.NumpadEquals=161]="NumpadEquals",y[y.NumpadLeftParen=162]="NumpadLeftParen",y[y.NumpadRightParen=163]="NumpadRightParen",y[y.VolumeMute=164]="VolumeMute",y[y.AndroidAppSwitch=187]="AndroidAppSwitch",y[y.AndroidCut=277]="AndroidCut",y[y.AndroidCopy=278]="AndroidCopy",y[y.AndroidPaste=279]="AndroidPaste";let ea=new ee.ZP().uint8("type").uint8("action",(0,ee.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),es=new ee.ZP().uint8("type").uint32("length").string("text",{lengthField:"length"});(L=Z||(Z={}))[L.Off=0]="Off",L[L.Normal=2]="Normal";let en=new ee.ZP().uint8("type").uint8("mode",(0,ee.W$)());class eo{#e;#$;#q;constructor(e){this.#e=e,this.#$=new ei(e),this.#q=e.createScrollController()}injectKeyCode(e){return ea.serialize(this.#$.fillMessageType(e,V.InjectKeyCode))}injectText(e){return es.serialize({text:e,type:this.#$.get(V.InjectText)})}injectTouch(e){return this.#e.serializeInjectTouchControlMessage(this.#$.fillMessageType(e,V.InjectTouch))}injectScroll(e){return this.#q.serializeScrollMessage(this.#$.fillMessageType(e,V.InjectScroll))}backOrScreenOn(e){return this.#e.serializeBackOrScreenOnControlMessage({action:e,type:this.#$.get(V.BackOrScreenOn)})}setScreenPowerMode(e){return en.serialize({mode:e,type:this.#$.get(V.SetScreenPowerMode)})}rotateDevice(){return et.serialize({type:this.#$.get(V.RotateDevice)})}}var el=i(5195);class ed{#X;#Y;constructor(e,t){this.#X=e,this.#Y=new eo(t)}async #Q(e){await el.ConsumableWritableStream.write(this.#X,e)}async injectKeyCode(e){await this.#Q(this.#Y.injectKeyCode(e))}async injectText(e){await this.#Q(this.#Y.injectText(e))}async injectTouch(e){await this.#Q(this.#Y.injectTouch(e))}async injectScroll(e){let t=this.#Y.injectScroll(e);t&&await this.#Q(t)}async backOrScreenOn(e){let t=this.#Y.backOrScreenOn(e);t&&await this.#Q(t)}async setScreenPowerMode(e){await this.#Q(this.#Y.setScreenPowerMode(e))}async rotateDevice(){await this.#Q(this.#Y.rotateDevice())}releaseLock(){this.#X.releaseLock()}async close(){await this.#X.close()}}(E=$||($={}))[E.Clipboard=0]="Clipboard",E[E.AckClipboard=1]="AckClipboard";let ec=new ee.ZP().uint64("sequence").extra({type:$.AckClipboard}),eh=new ee.ZP().uint32("length").string("content",{lengthField:"length"}).extra({type:$.Clipboard});class eu extends el.BufferedTransformStream{constructor(){super(async e=>{try{let t=await e.readExactly(1);switch(t[0]){case $.Clipboard:return await eh.deserialize(e);case $.AckClipboard:return await ec.deserialize(e);default:throw Error("Unsupported control message type")}}catch(e){if(e instanceof ee.tb)throw new ee.oU;if(e instanceof ee.oU)throw new ee.hy;throw e}})}}let ep={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class ef{value;constructor(e={}){this.value=e}toOptionValue(){let e=Object.entries(this.value).filter(([,e])=>void 0!==e);if(0!==e.length)return e.map(([e,t])=>{let i=ep[e];return`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}${i?`:${i}`:""}=${t}`}).join(",")}}function em(e,t,i){return e<t?t:e>i?i:e}let ew=new ee.Pl({size:2,signed:!1,deserialize(e,t){let i=ee.ek.Uint16.deserialize(e,t);return 65535===i?1:i/65536},serialize(e,t,i,r){i=1===(i=em(i,-1,1))?65535:65536*i,ee.ek.Uint16.serialize(e,t,i,r)}});(x=q||(q={})).Debug="debug",x.Info="info",x.Warn="warn",x.Error="error",(S=X||(X={}))[S.Unlocked=-1]="Unlocked",S[S.Portrait=0]="Portrait",S[S.Landscape=1]="Landscape",S[S.PortraitFlipped=2]="PortraitFlipped",S[S.LandscapeFlipped=3]="LandscapeFlipped";let eb=[V.InjectKeyCode,V.InjectText,V.InjectTouch,V.InjectScroll,V.BackOrScreenOn,V.ExpandNotificationPanel,V.CollapseNotificationPanel,V.GetClipboard,V.SetClipboard,V.SetScreenPowerMode,V.RotateDevice],ev=new ee.ZP().uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),eg=1n<<63n,ey=new ee.ZP().uint8("type").uint8("action",(0,ee.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",ew).uint32("buttons"),eL=new ee.ZP().uint8("type").uint32("length").string("content",{lengthField:"length"});(k=Y||(Y={}))[k.H264=1748121140]="H264",k[k.H265=1748121141]="H265",k[k.AV1=6387249]="AV1";class eE{static OPUS=new eE("opus",1869641075,"audio/opus","opus");static AAC=new eE("aac",6381923,"audio/aac","mp4a.66");static RAW=new eE("raw",7496055,"audio/raw","1");optionValue;metadataValue;mimeType;webCodecId;constructor(e,t,i,r){this.optionValue=e,this.metadataValue=t,this.mimeType=i,this.webCodecId=r}toOptionValue(){return this.optionValue}}let ex="/data/local/tmp/scrcpy-server.jar";function eS(e,t){var i;return"object"==typeof(i=e)&&null!==i&&"toOptionValue"in i&&"function"==typeof i.toOptionValue&&(e=e.toOptionValue()),void 0===e?t:String(e)}class ek{_base;get controlMessageTypes(){return this._base.controlMessageTypes}value;constructor(e,t){this._base=e,this.value=t,this.#J()}#J(){Object.assign(this._base,{value:this.value}),this._base instanceof ek&&this._base.#J()}setListEncoders(){this._base.setListEncoders()}setListDisplays(){this._base.setListDisplays()}parseEncoder(e){return this._base.parseEncoder(e)}parseDisplay(e){return this._base.parseDisplay(e)}parseVideoStreamMetadata(e){return this._base.parseVideoStreamMetadata(e)}parseAudioStreamMetadata(e){return this._base.parseAudioStreamMetadata(e)}createMediaStreamTransformer(){return this._base.createMediaStreamTransformer()}serializeInjectTouchControlMessage(e){return this._base.serializeInjectTouchControlMessage(e)}serializeBackOrScreenOnControlMessage(e){return this._base.serializeBackOrScreenOnControlMessage(e)}serializeSetClipboardControlMessage(e){return this._base.serializeSetClipboardControlMessage(e)}createScrollController(){return this._base.createScrollController()}}let eM=new ee.ZP().uint8("type").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class eA{#ee=0;#et=0;processMessage(e){this.#ee+=e.scrollX,this.#et+=e.scrollY;let t=0,i=0;if(this.#ee>=1?(t=1,this.#ee=0):this.#ee<=-1&&(t=-1,this.#ee=0),this.#et>=1?(i=1,this.#et=0):this.#et<=-1&&(i=-1,this.#et=0),0!==t||0!==i)return e.scrollX=t,e.scrollY=i,e}serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eM.serialize(t)}}class eN{static DEFAULTS={logLevel:q.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:X.Unlocked,tunnelForward:!1,crop:void 0,sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new ef};static SERIALIZE_ORDER=["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions"];static serialize(e,t){return t.map(t=>eS(e[t],"-"))}static async parseCString(e,t){let i=(0,ee.FO)(await e.readExactly(t));return i.substring(0,i.indexOf("\x00"))}static async parseUint16BE(e){let t=await e.readExactly(ee.ek.Uint16.size);return ee.ek.Uint16.deserialize(t,!1)}static async parseUint32BE(e){let t=await e.readExactly(ee.ek.Uint32.size);return ee.ek.Uint32.deserialize(t,!1)}value;defaults=eN.DEFAULTS;controlMessageTypes=eb;constructor(e){this.value={...eN.DEFAULTS,...e}}serialize(){return eN.serialize(this.value,eN.SERIALIZE_ORDER)}setListEncoders(){throw Error("Not supported")}setListDisplays(){this.value.displayId=-1}parseEncoder(){throw Error("Not supported")}parseDisplay(e){let t=e.match(/\s+scrcpy --display (\d+)/);if(t)return{id:Number.parseInt(t[1],10)}}parseVideoStreamMetadata(e){return(async()=>{let t=new el.BufferedReadableStream(e),i={codec:Y.H264};return i.deviceName=await eN.parseCString(t,64),i.width=await eN.parseUint16BE(t),i.height=await eN.parseUint16BE(t),{stream:t.release(),metadata:i}})()}parseAudioStreamMetadata(){throw Error("Not supported")}createMediaStreamTransformer(){if(!this.value.sendFrameMeta)return new el.TransformStream({transform(e,t){t.enqueue({type:"data",data:e})}});let e=new el.StructDeserializeStream(ev);return{writable:e.writable,readable:e.readable.pipeThrough(new el.TransformStream({transform(e,t){if(e.pts===eg){t.enqueue({type:"configuration",data:e.data});return}t.enqueue({type:"data",pts:e.pts,data:e.data})}}))}}serializeInjectTouchControlMessage(e){return ey.serialize(e)}serializeBackOrScreenOnControlMessage(e){if(e.action===G.Down)return et.serialize(e)}serializeSetClipboardControlMessage(e){return eL.serialize(e)}createScrollController(){return new eA}}class eC extends ek{static DEFAULTS={...eN.DEFAULTS,encoderName:void 0};static SERIALIZE_ORDER=[...eN.SERIALIZE_ORDER,"encoderName"];static parseEncoder(e,t){let i=e.match(t);if(i)return{type:"video",name:i[1]}}get defaults(){return eC.DEFAULTS}constructor(e){super(new eN(e),{...eC.DEFAULTS,...e})}serialize(){return eN.serialize(this.value,eC.SERIALIZE_ORDER)}setListEncoders(){this.value.encoderName="_"}parseEncoder(e){return eC.parseEncoder(e,/\s+scrcpy --encoder-name '(.*?)'/)}}(M=Q||(Q={})).Verbose="verbose",M.Debug="debug",M.Info="info",M.Warn="warn",M.Error="error",(A=J||(J={}))[A.Initial=-2]="Initial",A[A.Unlocked=-1]="Unlocked",A[A.Portrait=0]="Portrait",A[A.Landscape=1]="Landscape",A[A.PortraitFlipped=2]="PortraitFlipped",A[A.LandscapeFlipped=3]="LandscapeFlipped";let eT=new ee.ZP().concat(et).uint8("action",(0,ee.W$)()),ez=eb.slice();ez.splice(6,0,V.ExpandSettingPanel);let eU={[Q.Verbose]:q.Debug,[Q.Debug]:q.Debug,[Q.Info]:q.Info,[Q.Warn]:q.Warn,[Q.Error]:q.Error},eD={[J.Initial]:X.Unlocked,[J.Unlocked]:X.Unlocked,[J.Portrait]:X.Portrait,[J.Landscape]:X.Landscape,[J.PortraitFlipped]:X.PortraitFlipped,[J.LandscapeFlipped]:X.LandscapeFlipped};class eP extends ek{static DEFAULTS={...eC.DEFAULTS,logLevel:Q.Debug,lockVideoOrientation:J.Unlocked,powerOffOnClose:!1};static SERIALIZE_ORDER=[...eC.SERIALIZE_ORDER,"powerOffOnClose"];get defaults(){return eP.DEFAULTS}get controlMessageTypes(){return ez}constructor(e){let t={...eP.DEFAULTS,...e};super(new eC({...e,logLevel:eU[t.logLevel],lockVideoOrientation:eD[t.lockVideoOrientation]}),t)}serialize(){return eN.serialize(this.value,eP.SERIALIZE_ORDER)}parseEncoder(e){return eC.parseEncoder(e,/\s+scrcpy --encoder '(.*?)'/)}serializeBackOrScreenOnControlMessage(e){return eT.serialize(e)}}let eW=new ee.ZP().uint8("type").uint64("sequence").int8("paste",(0,ee.W$)()).uint32("length").string("content",{lengthField:"length"});class eO extends ek{static DEFAULTS={...eP.DEFAULTS,clipboardAutosync:!0};static serialize(e,t){let i=[];for(let[r,a]of Object.entries(e)){let e=eS(a,void 0);if(!e)continue;let s=eS(t[r],void 0);e!=s&&i.push(`${r.replace(/([A-Z])/g,"_$1").toLowerCase()}=${e}`)}return i}get defaults(){return eO.DEFAULTS}constructor(e){super(new eP(e),{...eO.DEFAULTS,...e})}serialize(){return eO.serialize(this.value,this.defaults)}serializeSetClipboardControlMessage(e){return eW.serialize(e)}}let eF=new ee.ZP().concat(eM).int32("buttons");class eI extends eA{serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eF.serialize(t)}}class e_ extends ek{static DEFAULTS={...eO.DEFAULTS,downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0};get defaults(){return e_.DEFAULTS}constructor(e){super(new eO(e),{...e_.DEFAULTS,...e})}parseVideoStreamMetadata(e){return this.value.sendDeviceMeta?this._base.parseVideoStreamMetadata(e):{stream:e,metadata:{codec:Y.H264}}}serialize(){return eO.serialize(this.value,this.defaults)}createScrollController(){return new eI}}let eR=1n<<62n;class eB extends ek{static DEFAULTS={...e_.DEFAULTS,cleanup:!0};get defaults(){return eB.DEFAULTS}constructor(e){super(new e_(e),{...eB.DEFAULTS,...e})}serialize(){return eO.serialize(this.value,this.defaults)}createMediaStreamTransformer(){let e=this._base.createMediaStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new el.TransformStream({transform(e,t){if("data"!==e.type){t.enqueue(e);return}void 0!==e.pts&&e.pts&eR&&(e.keyframe=!0,e.pts&=~eR),t.enqueue(e)}}))}}}class eH extends ek{static DEFAULTS={...eB.DEFAULTS,powerOn:!0};get defaults(){return eH.DEFAULTS}constructor(e){super(new eB(e),{...eH.DEFAULTS,...e})}serialize(){return eO.serialize(this.value,this.defaults)}}let eV=new ee.Pl({size:2,signed:!0,deserialize(e,t){let i=ee.ek.Int16.deserialize(e,t);return 32767===i?1:i/32768},serialize(e,t,i,r){i=1===(i=em(i,-1,1))?32767:32768*i,ee.ek.Int16.serialize(e,t,i,r)}}),eG=new ee.ZP().uint8("type",V.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("scrollX",eV).field("scrollY",eV).int32("buttons");class eK{serializeScrollMessage(e){return eG.serialize(e)}}class ej extends ek{get defaults(){return eH.DEFAULTS}constructor(e){super(new eH(e),{...eH.DEFAULTS,...e})}serialize(){return eO.serialize(this.value,this.defaults)}createScrollController(){return new eK}}let eZ=new ee.ZP().uint8("type").uint8("action",(0,ee.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",ew).uint32("actionButton").uint32("buttons");class e${static NONE=new e$(-1);static random(){return new e$(2147483648*Math.random()|0)}value;constructor(e){this.value=e}toOptionValue(){if(!(this.value<0))return this.value.toString(16)}}class eq extends ek{static DEFAULTS={...function(e,t){let i={};for(let r in e)t.includes(r)||(i[r]=e[r]);return i}(eH.DEFAULTS,["bitRate","codecOptions","encoderName"]),scid:e$.NONE,videoCodec:"h264",videoBitRate:8e6,videoCodecOptions:new ef,videoEncoder:"",audio:!0,audioCodec:"opus",audioBitRate:128e3,audioCodecOptions:new ef,audioEncoder:"",listEncoders:!1,listDisplays:!1,sendCodecMeta:!0};get defaults(){return eq.DEFAULTS}constructor(e){super(new ej(e),{...eq.DEFAULTS,...e})}serialize(){return eO.serialize(this.value,this.defaults)}setListEncoders(){this.value.listEncoders=!0}setListDisplays(){this.value.listDisplays=!0}parseEncoder(e){let t=e.match(/\s+--video-codec=(.*)\s+--video-encoder='(.*)'/);return t?{type:"video",codec:t[1],name:t[2]}:(t=e.match(/\s+--audio-codec=(.*)\s+--audio-encoder='(.*)'/))?{type:"audio",codec:t[1],name:t[2]}:void 0}parseDisplay(e){let t=e.match(/\s+--display=(\d+)\s+\((.*?)\)/);if(t){let e={id:Number.parseInt(t[1],10)};return"size unknown"!==t[2]&&(e.resolution=t[2]),e}}parseVideoStreamMetadata(e){let{sendDeviceMeta:t,sendCodecMeta:i}=this.value;if(!t&&!i){let t;switch(this.value.videoCodec){case"h264":t=Y.H264;break;case"h265":t=Y.H265;break;case"av1":t=Y.AV1}return{stream:e,metadata:{codec:t}}}return(async()=>{let r,a,s,n;let o=new el.BufferedReadableStream(e);if(t&&(r=await eN.parseCString(o,64)),i)a=await eN.parseUint32BE(o),s=await eN.parseUint32BE(o),n=await eN.parseUint32BE(o);else switch(this.value.videoCodec){case"h264":a=Y.H264;break;case"h265":a=Y.H265;break;case"av1":a=Y.AV1}return{stream:o.release(),metadata:{deviceName:r,codec:a,width:s,height:n}}})()}parseAudioStreamMetadata(e){return(async()=>{let t;let i=new el.BufferedReadableStream(e),r=await i.readExactly(ee.ek.Uint32.size),a=ee.ek.Uint32.deserialize(r,!1);switch(a){case 0:return{type:"disabled"};case 1:return{type:"errored"}}if(this.value.sendCodecMeta){let e;switch(a){case eE.OPUS.metadataValue:e=eE.OPUS;break;case eE.AAC.metadataValue:e=eE.AAC;break;case eE.RAW.metadataValue:e=eE.RAW;break;default:throw Error(`Unknown audio codec metadata value: ${a}`)}return{type:"success",codec:e,stream:i.release()}}switch(this.value.audioCodec){case"opus":t=eE.OPUS;break;case"aac":t=eE.AAC;break;case"raw":t=eE.RAW}return{type:"success",codec:t,stream:new el.PushReadableStream(async e=>{await e.enqueue(r);let t=i.release(),a=t.getReader();for(;;){let{done:t,value:i}=await a.read();if(t)break;await e.enqueue(i)}})}})()}serializeInjectTouchControlMessage(e){return eZ.serialize(e)}}class eX extends ek{static DEFAULTS={...eq.DEFAULTS,video:!0,audioSource:"output"};get defaults(){return eX.DEFAULTS}constructor(e){super(new eq(e),{...eX.DEFAULTS,...e})}serialize(){return eO.serialize(this.value,this.defaults)}}let eY=Q,eQ=J;class eJ extends eX{}},6261:function(e,t,i){i.d(t,{fX:function(){return tL},tz:function(){return tl}});var r,a,s,n,o,l,d,c,h,u,p,f,m,w,b,v,g,y,L,E,x,S,k,M,A,N,C,T,z,U,D,P,W,O,F,I,_,R,B,H,V,G,K,j,Z,$,q,X,Y,Q,J,ee,et,ei,er,ea,es,en,eo,el,ed,ec,eh,eu,ep,ef,em,ew,eb,ev,eg,ey,eL,eE,ex,eS,ek,eM,eA,eN,eC,eT,ez,eU,eD,eP,eW,eO,eF,eI,e_,eR,eB,eH,eV,eG,eK,ej,eZ,e$,eq,eX,eY,eQ,eJ,e1=Object.defineProperty,e0=Object.getOwnPropertySymbols,e2=Object.prototype.hasOwnProperty,e3=Object.prototype.propertyIsEnumerable,e4=Math.pow,e6=(e,t,i)=>t in e?e1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,e8=(e,t)=>{for(var i in t||={})e2.call(t,i)&&e6(e,i,t[i]);if(e0)for(var i of e0(t))e3.call(t,i)&&e6(e,i,t[i]);return e},e5=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},e7=(e,t,i)=>(e5(e,t,"read from private field"),i?i.call(e):t.get(e)),e9=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},te=(e,t,i,r)=>(e5(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),tt=(e,t,i)=>(e5(e,t,"access private method"),i),ti=class{constructor(e){this.value=e}},tr=class{constructor(e){this.value=e}},ta=e=>e<256?1:e<65536?2:e<16777216?3:e<e4(2,32)?4:e<e4(2,40)?5:6,ts=e=>{if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<268435455)return 4;if(e<e4(2,35)-1)return 5;if(e<e4(2,42)-1)return 6;throw Error("EBML VINT size not supported "+e)},tn=(e,t,i)=>{let r=0;for(let a=t;a<i;a++){let t=e[Math.floor(a/8)],i=7-(7&a);r<<=1,r|=(t&1<<i)>>i}return r},to=(e,t,i,r)=>{for(let a=t;a<i;a++){let t=Math.floor(a/8),s=e[t],n=7-(7&a);s&=~(1<<n),s|=(r&1<<i-a-1)>>i-a-1<<n,e[t]=s}},tl=class{constructor(){this.buffer=null}},td=class{constructor(e,t,i){this.onData=e,this.onDone=t,this.options=i}},tc=class{constructor(e,t){this.stream=e,this.options=t}},th=class{constructor(){e9(this,s),e9(this,o),e9(this,d),e9(this,h),e9(this,p),this.pos=0,e9(this,r,new Uint8Array(8)),e9(this,a,new DataView(e7(this,r).buffer)),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}seek(e){this.pos=e}writeEBMLVarInt(e,t=ts(e)){let i=0;switch(t){case 1:e7(this,a).setUint8(i++,128|e);break;case 2:e7(this,a).setUint8(i++,64|e>>8),e7(this,a).setUint8(i++,e);break;case 3:e7(this,a).setUint8(i++,32|e>>16),e7(this,a).setUint8(i++,e>>8),e7(this,a).setUint8(i++,e);break;case 4:e7(this,a).setUint8(i++,16|e>>24),e7(this,a).setUint8(i++,e>>16),e7(this,a).setUint8(i++,e>>8),e7(this,a).setUint8(i++,e);break;case 5:e7(this,a).setUint8(i++,8|e/e4(2,32)&7),e7(this,a).setUint8(i++,e>>24),e7(this,a).setUint8(i++,e>>16),e7(this,a).setUint8(i++,e>>8),e7(this,a).setUint8(i++,e);break;case 6:e7(this,a).setUint8(i++,4|e/e4(2,40)&3),e7(this,a).setUint8(i++,e/e4(2,32)|0),e7(this,a).setUint8(i++,e>>24),e7(this,a).setUint8(i++,e>>16),e7(this,a).setUint8(i++,e>>8),e7(this,a).setUint8(i++,e);break;default:throw Error("Bad EBML VINT size "+t)}this.write(e7(this,r).subarray(0,i))}writeEBML(e){var t,i;if(null!==e){if(e instanceof Uint8Array)this.write(e);else if(Array.isArray(e))for(let t of e)this.writeEBML(t);else if(this.offsets.set(e,this.pos),tt(this,h,u).call(this,e.id),Array.isArray(e.data)){let i=this.pos,r=-1===e.size?1:null!=(t=e.size)?t:4;-1===e.size?tt(this,s,n).call(this,255):this.seek(this.pos+r);let a=this.pos;if(this.dataOffsets.set(e,a),this.writeEBML(e.data),-1!==e.size){let e=this.pos-a,t=this.pos;this.seek(i),this.writeEBMLVarInt(e,r),this.seek(t)}}else if("number"==typeof e.data){let t=null!=(i=e.size)?i:ta(e.data);this.writeEBMLVarInt(t),tt(this,h,u).call(this,e.data,t)}else"string"==typeof e.data?(this.writeEBMLVarInt(e.data.length),tt(this,p,f).call(this,e.data)):e.data instanceof Uint8Array?(this.writeEBMLVarInt(e.data.byteLength,e.size),this.write(e.data)):e.data instanceof ti?(this.writeEBMLVarInt(4),tt(this,o,l).call(this,e.data.value)):e.data instanceof tr&&(this.writeEBMLVarInt(8),tt(this,d,c).call(this,e.data.value))}}};r=new WeakMap,a=new WeakMap,s=new WeakSet,n=function(e){e7(this,a).setUint8(0,e),this.write(e7(this,r).subarray(0,1))},o=new WeakSet,l=function(e){e7(this,a).setFloat32(0,e,!1),this.write(e7(this,r).subarray(0,4))},d=new WeakSet,c=function(e){e7(this,a).setFloat64(0,e,!1),this.write(e7(this,r))},h=new WeakSet,u=function(e,t=ta(e)){let i=0;switch(t){case 6:e7(this,a).setUint8(i++,e/e4(2,40)|0);case 5:e7(this,a).setUint8(i++,e/e4(2,32)|0);case 4:e7(this,a).setUint8(i++,e>>24);case 3:e7(this,a).setUint8(i++,e>>16);case 2:e7(this,a).setUint8(i++,e>>8);case 1:e7(this,a).setUint8(i++,e);break;default:throw Error("Bad UINT size "+t)}this.write(e7(this,r).subarray(0,i))},p=new WeakSet,f=function(e){this.write(new Uint8Array(e.split("").map(e=>e.charCodeAt(0))))};var tu=class extends th{constructor(e){super(),e9(this,v),e9(this,m,void 0),e9(this,w,new ArrayBuffer(e4(2,16))),e9(this,b,new Uint8Array(e7(this,w))),te(this,m,e)}write(e){tt(this,v,g).call(this,this.pos+e.byteLength),e7(this,b).set(e,this.pos),this.pos+=e.byteLength}finalize(){tt(this,v,g).call(this,this.pos),e7(this,m).buffer=e7(this,w).slice(0,this.pos)}};m=new WeakMap,w=new WeakMap,b=new WeakMap,v=new WeakSet,g=function(e){let t=e7(this,w).byteLength;for(;t<e;)t*=2;if(t===e7(this,w).byteLength)return;let i=new ArrayBuffer(t),r=new Uint8Array(i);r.set(e7(this,b),0),te(this,w,i),te(this,b,r)};var tp=class extends th{constructor(e,t){super(),e9(this,y,void 0),e9(this,L,[]),e9(this,E,0),e9(this,x,void 0),te(this,y,e),te(this,x,t)}write(e){e7(this,L).push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength}flush(){if(0===e7(this,L).length)return;let e=[],t=[...e7(this,L)].sort((e,t)=>e.start-t.start);e.push({start:t[0].start,size:t[0].data.byteLength});for(let i=1;i<t.length;i++){let r=e[e.length-1],a=t[i];a.start<=r.start+r.size?r.size=Math.max(r.size,a.start+a.data.byteLength-r.start):e.push({start:a.start,size:a.data.byteLength})}for(let t of e){for(let e of(t.data=new Uint8Array(t.size),e7(this,L)))t.start<=e.start&&e.start<t.start+t.size&&t.data.set(e.data,e.start-t.start);if(e7(this,x)&&t.start<e7(this,E))throw Error("Internal error: Monotonicity violation.");e7(this,y).onData(t.data,t.start),te(this,E,t.start+t.data.byteLength)}e7(this,L).length=0}finalize(){var e,t;null==(t=(e=e7(this,y)).onDone)||t.call(e)}};y=new WeakMap,L=new WeakMap,E=new WeakMap,x=new WeakMap;var tf=e4(2,24),tm=class extends th{constructor(e,t){var i,r;if(super(),e9(this,C),e9(this,z),e9(this,D),e9(this,W),e9(this,S,void 0),e9(this,k,void 0),e9(this,M,[]),e9(this,A,0),e9(this,N,void 0),te(this,S,e),te(this,k,null!=(r=null==(i=e.options)?void 0:i.chunkSize)?r:tf),te(this,N,t),!Number.isInteger(e7(this,k))||e7(this,k)<e4(2,10))throw Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(e){tt(this,C,T).call(this,e,this.pos),tt(this,W,O).call(this),this.pos+=e.byteLength}finalize(){var e,t;tt(this,W,O).call(this,!0),null==(t=(e=e7(this,S)).onDone)||t.call(e)}};S=new WeakMap,k=new WeakMap,M=new WeakMap,A=new WeakMap,N=new WeakMap,C=new WeakSet,T=function(e,t){let i=e7(this,M).findIndex(e=>e.start<=t&&t<e.start+e7(this,k));-1===i&&(i=tt(this,D,P).call(this,t));let r=e7(this,M)[i],a=t-r.start,s=e.subarray(0,Math.min(e7(this,k)-a,e.byteLength));r.data.set(s,a);let n={start:a,end:a+s.byteLength};if(tt(this,z,U).call(this,r,n),0===r.written[0].start&&r.written[0].end===e7(this,k)&&(r.shouldFlush=!0),e7(this,M).length>2){for(let e=0;e<e7(this,M).length-1;e++)e7(this,M)[e].shouldFlush=!0;tt(this,W,O).call(this)}s.byteLength<e.byteLength&&tt(this,C,T).call(this,e.subarray(s.byteLength),t+s.byteLength)},z=new WeakSet,U=function(e,t){let i=0,r=e.written.length-1,a=-1;for(;i<=r;){let s=Math.floor(i+(r-i+1)/2);e.written[s].start<=t.start?(i=s+1,a=s):r=s-1}for(e.written.splice(a+1,0,t),(-1===a||e.written[a].end<t.start)&&a++;a<e.written.length-1&&e.written[a].end>=e.written[a+1].start;)e.written[a].end=Math.max(e.written[a].end,e.written[a+1].end),e.written.splice(a+1,1)},D=new WeakSet,P=function(e){let t={start:Math.floor(e/e7(this,k))*e7(this,k),data:new Uint8Array(e7(this,k)),written:[],shouldFlush:!1};return e7(this,M).push(t),e7(this,M).sort((e,t)=>e.start-t.start),e7(this,M).indexOf(t)},W=new WeakSet,O=function(e=!1){for(let t=0;t<e7(this,M).length;t++){let i=e7(this,M)[t];if(i.shouldFlush||e){for(let e of i.written){if(e7(this,N)&&i.start+e.start<e7(this,A))throw Error("Internal error: Monotonicity violation.");e7(this,S).onData(i.data.subarray(e.start,e.end),i.start+e.start),te(this,A,i.start+e.end)}e7(this,M).splice(t--,1)}}};var tw=class extends tm{constructor(e,t){var i;super(new td((t,i)=>e.stream.write({type:"write",data:t,position:i}),void 0,{chunkSize:null==(i=e.options)?void 0:i.chunkSize}),t)}},tb=e4(2,15),tv=e4(2,12),tg="https://github.com/Vanilagy/webm-muxer",ty=["strict","offset","permissive"],tL=class{constructor(e){var t;e9(this,el),e9(this,ec),e9(this,eu),e9(this,ef),e9(this,ew),e9(this,ev),e9(this,ey),e9(this,eE),e9(this,eS),e9(this,eM),e9(this,eN),e9(this,eT),e9(this,eU),e9(this,eP),e9(this,eO),e9(this,eI),e9(this,eR),e9(this,eH),e9(this,eG),e9(this,ej),e9(this,e$),e9(this,eX),e9(this,eQ),e9(this,F,void 0),e9(this,I,void 0),e9(this,_,void 0),e9(this,R,void 0),e9(this,B,void 0),e9(this,H,void 0),e9(this,V,void 0),e9(this,G,void 0),e9(this,K,void 0),e9(this,j,void 0),e9(this,Z,void 0),e9(this,$,void 0),e9(this,q,void 0),e9(this,X,void 0),e9(this,Y,0),e9(this,Q,[]),e9(this,J,[]),e9(this,ee,[]),e9(this,et,void 0),e9(this,ei,void 0),e9(this,er,-1),e9(this,ea,-1),e9(this,es,-1),e9(this,en,void 0),e9(this,eo,!1),tt(this,el,ed).call(this,e),te(this,F,e8({type:"webm",firstTimestampBehavior:"strict"},e)),this.target=e.target;let i=!!e7(this,F).streaming;if(e.target instanceof tl)te(this,I,new tu(e.target));else if(e.target instanceof td)te(this,I,(null==(t=e.target.options)?void 0:t.chunked)?new tm(e.target,i):new tp(e.target,i));else if(e.target instanceof tc)te(this,I,new tw(e.target,i));else throw Error(`Invalid target: ${e.target}`);tt(this,ec,eh).call(this)}addVideoChunk(e,t,i){let r=new Uint8Array(e.byteLength);e.copyTo(r),this.addVideoChunkRaw(r,e.type,null!=i?i:e.timestamp,t)}addVideoChunkRaw(e,t,i,r){if(tt(this,eQ,eJ).call(this),!e7(this,F).video)throw Error("No video track declared.");void 0===e7(this,et)&&te(this,et,i),r&&tt(this,eU,eD).call(this,r);let a=tt(this,eI,e_).call(this,e,t,i,1);for("V_VP9"===e7(this,F).video.codec&&tt(this,eP,eW).call(this,a),te(this,er,a.timestamp);e7(this,J).length>0&&e7(this,J)[0].timestamp<=a.timestamp;){let e=e7(this,J).shift();tt(this,eH,eV).call(this,e,!1)}!e7(this,F).audio||a.timestamp<=e7(this,ea)?tt(this,eH,eV).call(this,a,!0):e7(this,Q).push(a),tt(this,eO,eF).call(this),tt(this,eN,eC).call(this)}addAudioChunk(e,t,i){let r=new Uint8Array(e.byteLength);e.copyTo(r),this.addAudioChunkRaw(r,e.type,null!=i?i:e.timestamp,t)}addAudioChunkRaw(e,t,i,r){if(tt(this,eQ,eJ).call(this),!e7(this,F).audio)throw Error("No audio track declared.");void 0===e7(this,ei)&&te(this,ei,i),(null==r?void 0:r.decoderConfig)&&(e7(this,F).streaming?te(this,j,tt(this,eG,eK).call(this,r.decoderConfig.description)):tt(this,ej,eZ).call(this,e7(this,j),r.decoderConfig.description));let a=tt(this,eI,e_).call(this,e,t,i,2);for(te(this,ea,a.timestamp);e7(this,Q).length>0&&e7(this,Q)[0].timestamp<=a.timestamp;){let e=e7(this,Q).shift();tt(this,eH,eV).call(this,e,!0)}!e7(this,F).video||a.timestamp<=e7(this,er)?tt(this,eH,eV).call(this,a,!e7(this,F).video):e7(this,J).push(a),tt(this,eO,eF).call(this),tt(this,eN,eC).call(this)}addSubtitleChunk(e,t,i){if(tt(this,eQ,eJ).call(this),!e7(this,F).subtitles)throw Error("No subtitle track declared.");(null==t?void 0:t.decoderConfig)&&(e7(this,F).streaming?te(this,Z,tt(this,eG,eK).call(this,t.decoderConfig.description)):tt(this,ej,eZ).call(this,e7(this,Z),t.decoderConfig.description));let r=tt(this,eI,e_).call(this,e.body,"key",null!=i?i:e.timestamp,3,e.duration,e.additions);te(this,es,r.timestamp),e7(this,ee).push(r),tt(this,eO,eF).call(this),tt(this,eN,eC).call(this)}finalize(){for(;e7(this,Q).length>0;)tt(this,eH,eV).call(this,e7(this,Q).shift(),!0);for(;e7(this,J).length>0;)tt(this,eH,eV).call(this,e7(this,J).shift(),!0);for(;e7(this,ee).length>0&&e7(this,ee)[0].timestamp<=e7(this,Y);)tt(this,eH,eV).call(this,e7(this,ee).shift(),!1);if(e7(this,F).streaming||tt(this,eX,eY).call(this),e7(this,I).writeEBML(e7(this,$)),!e7(this,F).streaming){let e=e7(this,I).pos,t=e7(this,I).pos-e7(this,eT,ez);e7(this,I).seek(e7(this,I).offsets.get(e7(this,_))+4),e7(this,I).writeEBMLVarInt(t,6),e7(this,V).data=new tr(e7(this,Y)),e7(this,I).seek(e7(this,I).offsets.get(e7(this,V))),e7(this,I).writeEBML(e7(this,V)),e7(this,B).data[0].data[1].data=e7(this,I).offsets.get(e7(this,$))-e7(this,eT,ez),e7(this,B).data[1].data[1].data=e7(this,I).offsets.get(e7(this,R))-e7(this,eT,ez),e7(this,B).data[2].data[1].data=e7(this,I).offsets.get(e7(this,H))-e7(this,eT,ez),e7(this,I).seek(e7(this,I).offsets.get(e7(this,B))),e7(this,I).writeEBML(e7(this,B)),e7(this,I).seek(e)}tt(this,eN,eC).call(this),e7(this,I).finalize(),te(this,eo,!0)}};F=new WeakMap,I=new WeakMap,_=new WeakMap,R=new WeakMap,B=new WeakMap,H=new WeakMap,V=new WeakMap,G=new WeakMap,K=new WeakMap,j=new WeakMap,Z=new WeakMap,$=new WeakMap,q=new WeakMap,X=new WeakMap,Y=new WeakMap,Q=new WeakMap,J=new WeakMap,ee=new WeakMap,et=new WeakMap,ei=new WeakMap,er=new WeakMap,ea=new WeakMap,es=new WeakMap,en=new WeakMap,eo=new WeakMap,el=new WeakSet,ed=function(e){if(e.type&&"webm"!==e.type&&"matroska"!==e.type)throw Error(`Invalid type: ${e.type}`);if(e.firstTimestampBehavior&&!ty.includes(e.firstTimestampBehavior))throw Error(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`)},ec=new WeakSet,eh=function(){tt(this,eu,ep).call(this),e7(this,F).streaming||tt(this,ev,eg).call(this),tt(this,ey,eL).call(this),tt(this,ef,em).call(this),tt(this,ew,eb).call(this),e7(this,F).streaming||(tt(this,eE,ex).call(this),tt(this,eS,ek).call(this)),tt(this,eM,eA).call(this),tt(this,eN,eC).call(this)},eu=new WeakSet,ep=function(){var e;let t={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:null!=(e=e7(this,F).type)?e:"webm"},{id:17031,data:2},{id:17029,data:2}]};e7(this,I).writeEBML(t)},ef=new WeakSet,em=function(){te(this,K,{id:236,size:4,data:new Uint8Array(tv)}),te(this,j,{id:236,size:4,data:new Uint8Array(tv)}),te(this,Z,{id:236,size:4,data:new Uint8Array(tv)})},ew=new WeakSet,eb=function(){te(this,G,{id:21936,data:[{id:21937,data:2},{id:21946,data:2},{id:21947,data:2},{id:21945,data:0}]})},ev=new WeakSet,eg=function(){let e=new Uint8Array([28,83,187,107]),t=new Uint8Array([21,73,169,102]),i=new Uint8Array([22,84,174,107]);te(this,B,{id:290298740,data:[{id:19899,data:[{id:21419,data:e},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:t},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:i},{id:21420,size:5,data:0}]}]})},ey=new WeakSet,eL=function(){let e={id:17545,data:new tr(0)};te(this,V,e),te(this,R,{id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:tg},{id:22337,data:tg},e7(this,F).streaming?null:e]})},eE=new WeakSet,ex=function(){let e={id:374648427,data:[]};te(this,H,e),e7(this,F).video&&e.data.push({id:174,data:[{id:215,data:1},{id:29637,data:1},{id:131,data:1},{id:134,data:e7(this,F).video.codec},e7(this,K),e7(this,F).video.frameRate?{id:2352003,data:1e9/e7(this,F).video.frameRate}:null,{id:224,data:[{id:176,data:e7(this,F).video.width},{id:186,data:e7(this,F).video.height},e7(this,F).video.alpha?{id:21440,data:1}:null,e7(this,G)]}]}),e7(this,F).audio&&(te(this,j,e7(this,F).streaming?e7(this,j)||null:{id:236,size:4,data:new Uint8Array(tv)}),e.data.push({id:174,data:[{id:215,data:2},{id:29637,data:2},{id:131,data:2},{id:134,data:e7(this,F).audio.codec},e7(this,j),{id:225,data:[{id:181,data:new ti(e7(this,F).audio.sampleRate)},{id:159,data:e7(this,F).audio.numberOfChannels},e7(this,F).audio.bitDepth?{id:25188,data:e7(this,F).audio.bitDepth}:null]}]})),e7(this,F).subtitles&&e.data.push({id:174,data:[{id:215,data:3},{id:29637,data:3},{id:131,data:17},{id:134,data:e7(this,F).subtitles.codec},e7(this,Z)]})},eS=new WeakSet,ek=function(){let e={id:408125543,size:e7(this,F).streaming?-1:6,data:[e7(this,F).streaming?null:e7(this,B),e7(this,R),e7(this,H)]};te(this,_,e),e7(this,I).writeEBML(e)},eM=new WeakSet,eA=function(){te(this,$,{id:475249515,data:[]})},eN=new WeakSet,eC=function(){e7(this,I) instanceof tp&&e7(this,I).flush()},eT=new WeakSet,ez=function(){return e7(this,I).dataOffsets.get(e7(this,_))},eU=new WeakSet,eD=function(e){if(e.decoderConfig){if(e.decoderConfig.colorSpace){let t=e.decoderConfig.colorSpace;if(te(this,en,t),e7(this,G).data=[{id:21937,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[t.matrix]},{id:21946,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[t.transfer]},{id:21947,data:{bt709:1,bt470bg:5,smpte170m:6}[t.primaries]},{id:21945,data:[1,2][Number(t.fullRange)]}],!e7(this,F).streaming){let e=e7(this,I).pos;e7(this,I).seek(e7(this,I).offsets.get(e7(this,G))),e7(this,I).writeEBML(e7(this,G)),e7(this,I).seek(e)}}e.decoderConfig.description&&(e7(this,F).streaming?te(this,K,tt(this,eG,eK).call(this,e.decoderConfig.description)):tt(this,ej,eZ).call(this,e7(this,K),e.decoderConfig.description))}},eP=new WeakSet,eW=function(e){if("key"!==e.type||!e7(this,en))return;let t=0;if(2!==tn(e.data,0,2))return;t+=2;let i=(tn(e.data,t+1,t+2)<<1)+tn(e.data,t+0,t+1);t+=2,3===i&&t++;let r=tn(e.data,t+0,t+1);if(t++,r)return;let a=tn(e.data,t+0,t+1);if(t++,0!==a)return;t+=2;let s=tn(e.data,t+0,t+24);if(t+=24,4817730!==s)return;i>=2&&t++;let n={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[e7(this,en).matrix];to(e.data,t+0,t+3,n)},eO=new WeakSet,eF=function(){let e=Math.min(e7(this,F).video?e7(this,er):1/0,e7(this,F).audio?e7(this,ea):1/0),t=e7(this,ee);for(;t.length>0&&t[0].timestamp<=e;)tt(this,eH,eV).call(this,t.shift(),!e7(this,F).video&&!e7(this,F).audio)},eI=new WeakSet,e_=function(e,t,i,r,a,s){return{data:e,additions:s,type:t,timestamp:tt(this,eR,eB).call(this,i,r),duration:a,trackNumber:r}},eR=new WeakSet,eB=function(e,t){let i=1===t?e7(this,er):2===t?e7(this,ea):e7(this,es);if(3!==t){let r=1===t?e7(this,et):e7(this,ei);if("strict"===e7(this,F).firstTimestampBehavior&&-1===i&&0!==e)throw Error(`The first chunk for your media track must have a timestamp of 0 (received ${e}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
If you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.
`);"offset"===e7(this,F).firstTimestampBehavior&&(e-=r)}if(e<i)throw Error(`Timestamps must be monotonically increasing (went from ${i} to ${e}).`);if(e<0)throw Error(`Timestamps must be non-negative (received ${e}).`);return e},eH=new WeakSet,eV=function(e,t){e7(this,F).streaming&&!e7(this,H)&&(tt(this,eE,ex).call(this),tt(this,eS,ek).call(this));let i=Math.floor(e.timestamp/1e3),r=t&&"key"===e.type&&i-e7(this,X)>=1e3;(!e7(this,q)||r)&&tt(this,e$,eq).call(this,i);let a=i-e7(this,X);if(a<0)return;if(a>=tb)throw Error(`Current Matroska cluster exceeded its maximum allowed length of ${tb} milliseconds. In order to produce a correct WebM file, you must pass in a key frame at least every ${tb} milliseconds.`);let s=new Uint8Array(4),n=new DataView(s.buffer);if(n.setUint8(0,128|e.trackNumber),n.setInt16(1,a,!1),void 0!==e.duration||e.additions){let t=Math.floor(e.duration/1e3),i={id:160,data:[{id:161,data:[s,e.data]},void 0!==e.duration?{id:155,data:t}:null,e.additions?{id:30113,data:e.additions}:null]};e7(this,I).writeEBML(i)}else{n.setUint8(3,Number("key"===e.type)<<7);let t={id:163,data:[s,e.data]};e7(this,I).writeEBML(t)}te(this,Y,Math.max(e7(this,Y),i))},eG=new WeakSet,eK=function(e){return{id:25506,size:4,data:new Uint8Array(e)}},ej=new WeakSet,eZ=function(e,t){let i=e7(this,I).pos;e7(this,I).seek(e7(this,I).offsets.get(e));let r=tv-(6+t.byteLength);if(r<0){let e=t.byteLength+r;t=t instanceof ArrayBuffer?t.slice(0,e):t.buffer.slice(0,e),r=0}e=[tt(this,eG,eK).call(this,t),{id:236,size:4,data:new Uint8Array(r)}],e7(this,I).writeEBML(e),e7(this,I).seek(i)},e$=new WeakSet,eq=function(e){e7(this,q)&&!e7(this,F).streaming&&tt(this,eX,eY).call(this),te(this,q,{id:524531317,size:e7(this,F).streaming?-1:5,data:[{id:231,data:e}]}),e7(this,I).writeEBML(e7(this,q)),te(this,X,e);let t=e7(this,I).offsets.get(e7(this,q))-e7(this,eT,ez);e7(this,$).data.push({id:187,data:[{id:179,data:e},e7(this,F).video?{id:183,data:[{id:247,data:1},{id:241,data:t}]}:null,e7(this,F).audio?{id:183,data:[{id:247,data:2},{id:241,data:t}]}:null]})},eX=new WeakSet,eY=function(){let e=e7(this,I).pos-e7(this,I).dataOffsets.get(e7(this,q)),t=e7(this,I).pos;e7(this,I).seek(e7(this,I).offsets.get(e7(this,q))+4),e7(this,I).writeEBMLVarInt(e,5),e7(this,I).seek(t)},eQ=new WeakSet,eJ=function(){if(e7(this,eo))throw Error("Cannot add new video or audio chunks after the file has been finalized.")},new TextEncoder,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakSet,new WeakSet}}]);
//# sourceMappingURL=199-8f082b130eaf5c4e.js.map