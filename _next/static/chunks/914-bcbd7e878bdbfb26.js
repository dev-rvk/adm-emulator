"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[914],{3717:function(e,t,i){i.d(t,{X:function(){return n}});var o=i(2420),r=i(1714);function n(){let[e,t]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e)return;let t=e.parentElement,i=t.style.flexGrow;return t.style.flexGrow="1",()=>{t.style.flexGrow=i}},[e]),(0,o.jsx)("div",{ref:t})}},4914:function(e,t,i){let o;i.r(t),i.d(t,{default:function(){return eH}});var r=i(2420),n=i(9035),a=i(482),s=i(5934),d=i(6683),l=i(160),c=i(4151),h=i(9828),u=i(8432),p=i(1725),g=i(3229),f=i(3703),y=i(7764),v=i(5862),m=i(6912),S=i.n(m),w=i(1714),b=i(2652),k=i(5313),C=i(9118),L=i(3925),x=i(3778),A=i(3717),P=i(4858);let E={[L.WP.H264]:"V_MPEG4/ISO/AVC",[L.WP.H265]:"V_MPEGH/ISO/HEVC",[L.WP.AV1]:"V_AV1"},T={[L.$e.RAW.mimeType]:"A_PCM/INT/LIT",[L.$e.AAC.mimeType]:"A_AAC",[L.$e.OPUS.mimeType]:"A_OPUS"};class _{addVideoChunk(e){-1===this._firstTimestamp&&(this._firstTimestamp=Number(e.pts));let t=function(e){let t=[],i=0;for(let o of(0,L.qC)(e))t.push(o),i+=o.byteLength+4;let o=new Uint8Array(i),r=0;for(let e of t)o[r]=e.byteLength>>24,o[r+1]=e.byteLength>>16,o[r+2]=e.byteLength>>8,o[r+3]=255&e.byteLength,o.set(e,r+4),r+=4+e.byteLength;return o}(e.data);this.muxer.addVideoChunkRaw(t,e.keyframe?"key":"delta",Number(e.pts)-this._firstTimestamp,this.configurationWritten?void 0:{decoderConfig:{codec:"",description:this.videoCodecDescription}}),this.configurationWritten=!0}addVideoPacket(e){if(!this.videoMetadata)throw Error("videoMetadata must be set");try{if("configuration"===e.type){switch(this.videoMetadata.codec){case L.WP.H264:{let{sequenceParameterSet:t,pictureParameterSet:i}=(0,L.MN)(e.data);this.videoCodecDescription=function(e,t){let i=new Uint8Array(11+e.byteLength+t.byteLength);return i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225,i[6]=e.byteLength>>8,i[7]=255&e.byteLength,i.set(e,8),i[8+e.byteLength]=1,i[9+e.byteLength]=t.byteLength>>8,i[10+e.byteLength]=255&t.byteLength,i.set(t,11+e.byteLength),i}(t,i),this.configurationWritten=!1;break}case L.WP.H265:{let{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:o}=(0,L.mc)(e.data);this.videoCodecDescription=function(e,t,i){let{profileTierLevel:{generalProfileTier:{profile_space:o,tier_flag:r,profile_idc:n,profileCompatibilitySet:a,constraintSet:s},general_level_idc:d},vps_max_layers_minus1:l,vps_temporal_id_nesting_flag:c}=(0,L.r_)(e.rbsp),{chroma_format_idc:h,bit_depth_luma_minus8:u,bit_depth_chroma_minus8:p,vuiParameters:{min_spatial_segmentation_idc:g=0}={}}=(0,L.tW)(t.rbsp),f=new Uint8Array(38+e.data.length+t.data.length+i.data.length);f[0]=1,f[1]=o<<6|Number(r)<<5|n,f[2]=a[0],f[3]=a[1],f[4]=a[2],f[5]=a[3],f[6]=s[0],f[7]=s[1],f[8]=s[2],f[9]=s[3],f[10]=s[4],f[11]=s[5],f[12]=d,f[13]=240|g>>8,f[14]=g,f[15]=252,f[16]=252|h,f[17]=248|u,f[18]=248|p,f[19]=0,f[20]=0,f[21]=l+1<<3|Number(c)<<2|3,f[22]=3;let y=23;for(let o of[e,t,i])f[y]=o.nal_unit_type,f[y+=1]=0,f[y+=1]=1,f[y+=1]=o.data.length>>8,f[y+=1]=o.data.length,y+=1,f.set(o.data,y),y+=o.data.length;return f}(t,i,o),this.configurationWritten=!1}}return}if(!0===e.keyframe&&(this._packetsFromLastKeyframe.length=0),this._packetsFromLastKeyframe.push({type:"video",packet:e}),!this.muxer)return;this.addVideoChunk(e)}catch(e){console.error(e)}}addAudioChunk(e){if(-1===this._firstTimestamp)return;let t=Number(e.pts)-this._firstTimestamp;!(t<0)&&this.muxer&&this.muxer.addAudioChunkRaw(e.data,"key",t)}addAudioPacket(e){this._packetsFromLastKeyframe.push({type:"audio",packet:e}),this.addAudioChunk(e)}start(){var e,t;if(!this.videoMetadata)throw Error("videoMetadata must be set");this.running=!0;let i={target:new P.tz,type:"matroska",firstTimestampBehavior:"permissive",video:{codec:E[this.videoMetadata.codec],width:null!==(e=this.videoMetadata.width)&&void 0!==e?e:0,height:null!==(t=this.videoMetadata.height)&&void 0!==t?t:0}};if(this.audioCodec&&(i.audio={codec:T[this.audioCodec.mimeType],sampleRate:48e3,numberOfChannels:2,bitDepth:this.audioCodec===L.$e.RAW?16:void 0}),this.muxer=new P.fX(i),this._packetsFromLastKeyframe.length>0)for(let{type:e,packet:t}of this._packetsFromLastKeyframe)"video"===e?this.addVideoChunk(t):this.addAudioChunk(t)}stop(){if(!this.muxer)return;this.muxer.finalize();let e=this.muxer.target.buffer,t=new Date,i=(0,x.yH)("Recording ".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0")," ").concat(t.getHours().toString().padStart(2,"0"),"-").concat(t.getMinutes().toString().padStart(2,"0"),"-").concat(t.getSeconds().toString().padStart(2,"0"),".mkv")),o=i.getWriter();o.write(new Uint8Array(e)),o.close(),this.muxer=void 0,this.configurationWritten=!1,this.running=!1}constructor(){this.running=!1,this.configurationWritten=!1,this._firstTimestamp=-1,this._packetsFromLastKeyframe=[]}}let D=(0,y.ky)({recorder:new _,recording:!1,intervalId:-1,hours:0,minutes:0,seconds:0});(0,y.U5)(()=>D.recording,e=>{e?D.intervalId=globalThis.setInterval((0,y.aD)(()=>{D.seconds+=1,D.seconds>=60&&(D.seconds=0,D.minutes+=1),D.minutes>=60&&(D.minutes=0,D.hours+=1)}),1e3):(globalThis.clearInterval(D.intervalId),D.intervalId=-1,D.hours=0,D.minutes=0,D.seconds=0)});var O=i(513),z=i(5572),M=i(5527),R=i(6323),j=i(352),N=i(5121),V=i(6399);class I extends N.TransformStream{constructor(e){let t;super({start(e){t=new AudioDecoder({error(t){console.log("audio decoder error: ",t),e.error(t)},output(t){e.enqueue(Array.from({length:2},(e,i)=>{let o={format:"f32-planar",planeIndex:i},r=new Float32Array(t.allocationSize(o)/Float32Array.BYTES_PER_ELEMENT);return t.copyTo(r,o),r}))}})},transform(i){switch(i.type){case"configuration":t.configure({...e,description:i.data});break;case"data":t.decode(new EncodedAudioChunk({data:i.data,type:"key",timestamp:0}))}},async flush(){await t.flush()}})}}class H extends N.TransformStream{constructor(e){let t;super({start(i){(t=new AudioDecoder({error(e){console.log("audio decoder error: ",e),i.error(e)},output(e){let t={format:"f32",planeIndex:0},o=new Float32Array(e.allocationSize(t)/Float32Array.BYTES_PER_ELEMENT);e.copyTo(o,t),i.enqueue(o)}})).configure(e)},transform(e){switch(e.type){case"configuration":break;case"data":if(0===e.data.length)break;t.decode(new EncodedAudioChunk({type:"key",timestamp:0,data:e.data}))}},async flush(){await t.flush()}})}}var U=i(3997);class W{get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(e){var t;let i=await globalThis.fetch(e);this._total=Number.parseInt(null!==(t=i.headers.get("Content-Length"))&&void 0!==t?t:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let o=i.body.getReader(),r=[];for(;;){let e=await o.read();if(e.done)break;r.push(e.value),this._downloaded+=e.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=r.reduce((e,t)=>e+t.byteLength,0);let n=new Uint8Array(this._total),a=0;for(let e of r)n.set(e,a),a+=e.byteLength;return n}constructor(e){this._downloaded=0,this._total=0,this.progressEvent=new U.vp,this.promise=this.fetch(e)}}function K(e){return o||(o=new W(R.q)).promise.catch(()=>{o=void 0}),e&&(o.onProgress(e),e([o.downloaded,o.total])),o.promise}var B=i(4449);class Y{setModifier(e,t){switch(e){case L.AY.ControlLeft:this._controlLeft=t;break;case L.AY.ControlRight:this._controlRight=t;break;case L.AY.ShiftLeft:this._shiftLeft=t;break;case L.AY.ShiftRight:this._shiftRight=t;break;case L.AY.AltLeft:this._altLeft=t;break;case L.AY.AltRight:this._altRight=t;break;case L.AY.MetaLeft:this._metaLeft=t;break;case L.AY.MetaRight:this._metaRight=t;break;case L.AY.CapsLock:t&&(this._capsLock=!this._capsLock);break;case L.AY.NumLock:t&&(this._numLock=!this._numLock)}}getMetaState(){let e=0;return this._altLeft&&(e|=L.OV.AltOn|L.OV.AltLeftOn),this._altRight&&(e|=L.OV.AltOn|L.OV.AltRightOn),this._shiftLeft&&(e|=L.OV.ShiftOn|L.OV.ShiftLeftOn),this._shiftRight&&(e|=L.OV.ShiftOn|L.OV.ShiftRightOn),this._controlLeft&&(e|=L.OV.CtrlOn|L.OV.CtrlLeftOn),this._controlRight&&(e|=L.OV.CtrlOn|L.OV.CtrlRightOn),this._metaLeft&&(e|=L.OV.MetaOn|L.OV.MetaLeftOn),this._metaRight&&(e|=L.OV.MetaOn|L.OV.MetaRightOn),this._capsLock&&(e|=L.OV.CapsLockOn),this._numLock&&(e|=L.OV.NumLockOn),e}async down(e){var t;let i=L.AY[e];i&&(this.setModifier(i,!0),this._keys.add(i),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:L.vH.Down,keyCode:i,metaState:this.getMetaState(),repeat:0})))}async up(e){var t;let i=L.AY[e];i&&(this.setModifier(i,!1),this._keys.delete(i),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:L.vH.Up,keyCode:i,metaState:this.getMetaState(),repeat:0})))}async reset(){for(let e of(this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._keys))this.up(L.AY[e]);this._keys.clear()}dispose(){}constructor(e){this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._capsLock=!1,this._numLock=!0,this._keys=new Set,this.client=e}}class F{static async register(e){let t=await B.qG.register(e,0,B.XC.DESCRIPTOR);return new F(t)}async down(e){let t=B.sm[e];t&&(this.hidKeyboard.down(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async up(e){let t=B.sm[e];t&&(this.hidKeyboard.up(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async reset(){this.hidKeyboard.reset(),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport())}async dispose(){await this.aoaKeyboard.unregister()}constructor(e){this.hidKeyboard=new B.XC,this.aoaKeyboard=e}}var G=i(8046),J=i(3844),q=i(2258),X=i(2430),Z=i(2515),$=i(5823),Q=i(3417),ee=i(7005),et=i(6174);let ei=(0,p.Z)({labelRight:{marginLeft:"4px"},item:{width:"100%",maxWidth:"300px"}}),eo=(0,v.Pi)(function(e){let{definition:t,value:i,onChange:o}=e,n=ei(),a=(0,r.jsxs)(s.K,{horizontal:!0,verticalAlign:"center",children:[(0,r.jsx)("span",{children:t.label}),!!t.description&&(0,r.jsx)(G.G,{content:t.description,children:(0,r.jsx)(J.J,{className:n.labelRight,iconName:x.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,r.jsx)(q.n,{className:n.item,label:a,placeholder:t.placeholder,value:i,onChange:(e,i)=>o(t,i)});case"dropdown":return(0,r.jsx)(X.L,{className:n.item,label:a,options:t.options,placeholder:t.placeholder,selectedKey:i,onChange:(e,i)=>o(t,i.key)});case"toggle":return(0,r.jsx)(Z.Z,{label:a,checked:i,disabled:t.disabled,onChange:(e,i)=>o(t,i)});case"number":return(0,r.jsx)($.k,{className:n.item,label:t.label,labelPosition:Q.L.top,min:t.min,max:t.max,step:t.step,value:i.toString(),onChange:(e,i)=>o(t,Number.parseInt(i,10))})}}),er={maxSize:1080,videoBitRate:4e6,videoCodec:"h264",lockVideoOrientation:L.J4.Unlocked,displayId:0,crop:"",powerOn:!0,audio:!0,audioCodec:"aac"},en=(0,y.ky)({displays:[],encoders:[],decoders:[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:et.EV}],settings:er,clientSettings:{}},{decoders:y.LO.shallow,settings:y.LO.deep,clientSettings:y.LO.deep}),ea="/data/local/tmp/.tango.json";(0,y.EH)(()=>{V.GLOBAL_STATE.adb&&((async()=>{let e=await V.GLOBAL_STATE.adb.sync();try{let t=await e.read(ea).pipeThrough(new N.DecodeUtf8Stream).pipeThrough(new N.ConcatStringStream),i=JSON.parse(t);i.settings.videoCodecOptions=new L.P3(i.settings.videoCodecOptions),i.settings.audioCodecOptions=new L.P3(i.settings.audioCodecOptions),(0,y.z)(()=>{en.settings={...er,...i.settings},en.clientSettings=i.clientSettings})}catch(e){if(!(e instanceof O.AdbSyncError))throw e}finally{await e.dispose()}})(),(0,y.z)(()=>{en.encoders=[],en.displays=[],en.settings.displayId=void 0}))}),(0,y.EH)(()=>{en.clientSettings.decoder=en.decoders[0].key});let es=(0,y.Fl)(()=>{let e=[];return e.push({group:"settings",key:"powerOn",type:"toggle",label:"Wake device up on start"},{group:"clientSettings",key:"turnScreenOff",type:"toggle",label:"Turn screen off during mirroring"},{group:"settings",key:"stayAwake",type:"toggle",label:"Stay awake during mirroring (if plugged in)"},{group:"settings",key:"powerOffOnClose",type:"toggle",label:"Turn device off on stop"}),e.push({group:"settings",key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,r.jsx)(ee.h,{iconProps:{iconName:x.PJ.ArrowClockwise},disabled:!V.GLOBAL_STATE.adb,text:"Refresh",onClick:async()=>{try{await ed.pushServer();let e=await M.NE.getDisplays(V.GLOBAL_STATE.adb,L.K1,R.d,new M.vg(new L.qq({logLevel:L.VE.Debug})));(0,y.z)(()=>{if(en.displays=e,!en.settings.displayId||!en.displays.some(e=>e.id===en.settings.displayId)){var t;en.settings.displayId=null===(t=en.displays[0])||void 0===t?void 0:t.id}})}catch(e){V.GLOBAL_STATE.showErrorDialog(e)}}}),options:en.displays.map(e=>({key:e.id,text:"".concat(e.id).concat(e.resolution?" (".concat(e.resolution,")"):"")}))}),e.push({group:"settings",key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({group:"settings",key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50},{group:"settings",key:"videoBitRate",type:"number",label:"Max Video Bitrate (bps)",min:100,max:1e8,step:100},{group:"settings",key:"videoCodec",type:"dropdown",label:"Video Codec",options:[{key:"h264",text:"H.264"},{key:"h265",text:"H.265"}]},{group:"settings",key:"videoEncoder",type:"dropdown",label:"Video Encoder",placeholder:0===en.encoders.length?"Press refresh button to update encoder list":"(default)",labelExtra:(0,r.jsx)(ee.h,{iconProps:{iconName:x.PJ.ArrowClockwise},disabled:!V.GLOBAL_STATE.adb,text:"Refresh",onClick:async()=>{try{await ed.pushServer();let e=await M.NE.getEncoders(V.GLOBAL_STATE.adb,L.K1,R.d,new M.vg(new L.qq({logLevel:L.VE.Debug})));(0,y.z)(()=>{en.encoders=e})}catch(e){V.GLOBAL_STATE.showErrorDialog(e)}}}),options:en.encoders.filter(e=>"video"===e.type&&(!e.codec||e.codec===en.settings.videoCodec)).map(e=>({key:e.name,text:e.name}))}),e.push({group:"settings",key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:L.J4.Unlocked,text:"Unlocked"},{key:L.J4.Initial,text:"Current"},{key:L.J4.Portrait,text:"Portrait"},{key:L.J4.Landscape,text:"Landscape"},{key:L.J4.PortraitFlipped,text:"Portrait (Flipped)"},{key:L.J4.LandscapeFlipped,text:"Landscape (Flipped)"}]}),en.decoders.length>1&&e.push({group:"clientSettings",key:"decoder",type:"dropdown",label:"Video Decoder",options:en.decoders.map(e=>({key:e.key,text:e.name,data:e}))}),e.push({group:"clientSettings",key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore video decoder's codec options",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({group:"settings",key:"audio",type:"toggle",label:"Forward Audio (Requires Android 11)"},{group:"settings",key:"audioCodec",type:"dropdown",label:"Audio Codec",options:[{key:"raw",text:"Raw"},{key:"aac",text:"AAC"},{key:"opus",text:"Opus"}]},{group:"settings",key:"audioEncoder",type:"dropdown",placeholder:0===en.encoders.length?"Press refresh button to update encoder list":"(default)",label:"Audio Encoder",labelExtra:(0,r.jsx)(ee.h,{iconProps:{iconName:x.PJ.ArrowClockwise},disabled:!V.GLOBAL_STATE.adb,text:"Refresh",onClick:async()=>{try{await ed.pushServer();let e=await M.NE.getEncoders(V.GLOBAL_STATE.adb,L.K1,R.d,new M.vg(new L.qq({logLevel:L.VE.Debug})));(0,y.z)(()=>{en.encoders=e})}catch(e){V.GLOBAL_STATE.showErrorDialog(e)}}}),options:en.encoders.filter(e=>"audio"===e.type&&e.codec===en.settings.audioCodec).map(e=>({key:e.name,text:e.name}))}),e});(0,y.EH)(()=>{if(0===en.encoders.length){en.settings.videoEncoder="",en.settings.audioEncoder="";return}let e=en.encoders.filter(e=>"video"===e.type&&e.codec===en.settings.videoCodec);en.settings.videoEncoder&&e.every(e=>e.name!==en.settings.videoEncoder)&&(en.settings.videoEncoder="");let t=en.encoders.filter(e=>"audio"===e.type&&e.codec===en.settings.audioCodec);en.settings.audioEncoder&&t.every(e=>e.name!==en.settings.audioEncoder)&&(en.settings.audioEncoder="")});let ed=new class{get rotatedWidth(){return 1&ed.rotation?ed.height:ed.width}get rotatedHeight(){return 1&ed.rotation?ed.width:ed.height}async pushServer(){let e=await K();await M.NE.pushServer(V.GLOBAL_STATE.adb,new N.ReadableStream({start(t){t.enqueue(new N.Consumable(e)),t.close()}}))}async stop(){var e;await (null===(e=this.client)||void 0===e?void 0:e.close()),this.dispose()}dispose(){var e,t,i;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,D.recording&&(D.recorder.stop(),D.recording=!1),null===(t=this.keyboard)||void 0===t||t.dispose(),this.keyboard=void 0,null===(i=this.audioPlayer)||void 0===i||i.stop(),this.audioPlayer=void 0,this.fps="0",clearTimeout(this.fpsCounterIntervalId),this.isFullScreen&&(document.exitFullscreen(),this.isFullScreen=!1),this.client=void 0,this.running=!1}setFullScreenContainer(e){this.fullScreenContainer=e}setRendererContainer(e){this.rendererContainer=e}clientPositionToDevicePosition(e,t){let i=this.rendererContainer.getBoundingClientRect(),o=(0,L.uZ)((e-i.x)/i.width,0,1),r=(0,L.uZ)((t-i.y)/i.height,0,1);switch(1&this.rotation&&([o,r]=[r,o]),this.rotation){case 1:r=1-r;break;case 2:o=1-o,r=1-r;break;case 3:o=1-o}return{x:o*this.width,y:r*this.height}}constructor(){this.running=!1,this.fullScreenContainer=null,this.rendererContainer=null,this.isFullScreen=!1,this.logVisible=!1,this.log=[],this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotation=0,this.client=void 0,this.hoverHelper=void 0,this.keyboard=void 0,this.audioPlayer=void 0,this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps="0",this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.start=async()=>{if(V.GLOBAL_STATE.adb)try{var e,t;let i;if(!en.clientSettings.decoder)throw Error("No available decoder");(0,y.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let o=setInterval((0,y.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{i=await K((0,y.aD)(e=>{let[t,i]=e;this.serverDownloadedSize=t,this.serverTotalSize=i})),(0,y.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(o)}o=setInterval((0,y.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await M.NE.pushServer(V.GLOBAL_STATE.adb,new N.ReadableStream({start(e){e.enqueue(new N.Consumable(i)),e.close()}}).pipeThrough(new N.DistributionStream(O.ADB_SYNC_MAX_PACKET_SIZE)).pipeThrough(new x.hK((0,y.aD)(e=>{this.serverUploadedSize=e})))),(0,y.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(o)}let r=null!==(t=en.decoders.find(e=>e.key===en.clientSettings.decoder))&&void 0!==t?t:en.decoders[0],n=new L.P3;if(!en.clientSettings.ignoreDecoderCodecArgs){let e=r.Constructor.capabilities[en.settings.videoCodec];e&&(n.value.profile=e.maxProfile,n.value.level=e.maxLevel)}let a=new M.vg(new L.qq({...en.settings,logLevel:L.VE.Debug,scid:L.Kn.random(),sendDeviceMeta:!1,sendDummyByte:!1,videoCodecOptions:n}));(0,y.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat(R.d)),this.log.push("[client] Server arguments: ".concat(a.serialize().join(" ")))});let s=await M.NE.start(V.GLOBAL_STATE.adb,L.K1,R.d,a);s.stdout.pipeTo(new N.WritableStream({write:(0,y.aD)(e=>{this.log.push(e)})}));let d=await V.GLOBAL_STATE.adb.sync();try{await d.write({filename:ea,file:new N.ReadableStream({start(e){e.enqueue(new N.Consumable((0,O.encodeUtf8)(JSON.stringify({settings:en.settings,clientSettings:en.clientSettings},(e,t)=>t instanceof L.P3?t.value:t)))),e.close()}})})}finally{d.dispose()}D.recorder=new _,s.videoStream.then(e=>{let{stream:t,metadata:i}=e;(0,y.z)(()=>{D.recorder.videoMetadata=i});let o=new r.Constructor(i.codec);(0,y.z)(()=>{this.decoder=o;let e=0,t=0;this.fpsCounterIntervalId=setInterval((0,y.aD)(()=>{let i=o.frameRendered-e,r=o.frameSkipped-t;this.fps="".concat(i).concat(r?"+".concat(r," skipped"):""),e=o.frameRendered,t=o.frameSkipped}),1e3)});let n=0n,a=new N.InspectStream(e=>{if(D.recorder.addVideoPacket(e),"configuration"===e.type){let t,o;switch(i.codec){case L.WP.H264:({croppedWidth:t,croppedHeight:o}=(0,L.VM)(e.data));break;case L.WP.H265:({croppedWidth:t,croppedHeight:o}=(0,L.hA)(e.data));break;default:throw Error("Codec not supported")}(0,y.z)(()=>{this.log.push("[client] Video size changed: ".concat(t,"x").concat(o)),this.width=t,this.height=o})}else if(e.keyframe&&void 0!==e.pts){if(n){let t=Number(e.pts-n)/1e3|0;(0,y.z)(()=>{this.log.push("[client] Keyframe interval: ".concat(t,"ms"))})}n=e.pts}});t.pipeThrough(a).pipeTo(o.writable)}),null===(e=s.audioStream)||void 0===e||e.then(async e=>{switch(e.type){case"disabled":(0,y.z)(()=>this.log.push("[client] Demuxer audio: stream explicitly disabled by the device"));return;case"errored":(0,y.z)(()=>this.log.push("[client] Demuxer audio: stream configuration error on the device"));return;case"success":break;default:throw Error("Unexpected audio metadata type ".concat(e.type))}let[t,i]=e.stream.tee();switch(e.codec){case L.$e.RAW:{let e=new j.ED(48e3);this.audioPlayer=e,i.pipeTo(new N.WritableStream({write:t=>{e.feed(new Int16Array(t.data.buffer,t.data.byteOffset,t.data.byteLength/Int16Array.BYTES_PER_ELEMENT))}})),await this.audioPlayer.start();break}case L.$e.OPUS:{let t=new j.C(48e3);this.audioPlayer=t,i.pipeThrough(new H({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new N.WritableStream({write:e=>{t.feed(e)}})),await t.start();break}case L.$e.AAC:{let t=new j.PT(48e3);this.audioPlayer=t,i.pipeThrough(new I({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new N.WritableStream({write:e=>{t.feed(e)}})),await t.start();break}default:throw Error("Unsupported audio codec ".concat(e.codec.optionValue))}(0,y.z)(()=>{D.recorder.audioCodec=e.codec}),t.pipeTo(new N.WritableStream({write:e=>{"data"===e.type&&D.recorder.addAudioPacket(e)}}))}),s.exit.then(this.dispose),s.deviceMessageStream.pipeTo(new N.WritableStream({write(e){e.type===L.L5.Clipboard&&globalThis.navigator.clipboard.writeText(e.content)}})),en.clientSettings.turnScreenOff&&await s.controlMessageWriter.setScreenPowerMode(L.Mr.Off),(0,y.z)(()=>{this.client=s,this.hoverHelper=new L.iX,this.running=!0});let l=V.GLOBAL_STATE.device;l instanceof z.Of?this.keyboard=await F.register(l.raw):this.keyboard=new Y(s)}catch(e){V.GLOBAL_STATE.showErrorDialog(e)}finally{(0,y.z)(()=>{this.connecting=!1})}},(0,y.ky)(this,{start:!1,stop:y.aD.bound,dispose:y.aD.bound,setFullScreenContainer:y.aD.bound,setRendererContainer:y.aD.bound,clientPositionToDevicePosition:!1}),(0,y.EH)(()=>{V.GLOBAL_STATE.adb||this.dispose()}),"object"==typeof document&&document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(0,y.z)(()=>{this.isFullScreen=!1})}),(0,y.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}})}},el=(0,y.Fl)(()=>{let e=[];return e.push({key:"stop",iconProps:{iconName:x.PJ.Stop},text:"Stop",onClick:ed.stop}),e.push(D.recording?{key:"Record",iconProps:{iconName:x.PJ.Record,style:{color:"red"}},text:"".concat(D.hours?"".concat(D.hours,":"):"").concat(D.minutes.toString().padStart(2,"0"),":").concat(D.seconds.toString().padStart(2,"0")),onClick:(0,y.aD)(()=>{ed.fullScreenContainer.focus(),D.recorder.stop(),D.recording=!1})}:{key:"Record",disabled:!ed.running,iconProps:{iconName:x.PJ.Record},text:"Record",onClick:(0,y.aD)(()=>{ed.fullScreenContainer.focus(),D.recorder.start(),D.recording=!0})}),e.push({key:"volumeUp",disabled:!ed.running,iconProps:{iconName:x.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var e,t;ed.fullScreenContainer.focus(),await (null===(e=ed.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:L.vH.Down,keyCode:L.AY.VolumeUp,repeat:0,metaState:0})),await (null===(t=ed.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:L.vH.Up,keyCode:L.AY.VolumeUp,repeat:0,metaState:0}))}},{key:"volumeDown",disabled:!ed.running,iconProps:{iconName:x.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var e,t;ed.fullScreenContainer.focus(),await (null===(e=ed.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:L.vH.Down,keyCode:L.AY.VolumeDown,repeat:0,metaState:0})),await (null===(t=ed.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:L.vH.Up,keyCode:L.AY.VolumeDown,repeat:0,metaState:0}))}},{key:"volumeMute",disabled:!ed.running,iconProps:{iconName:x.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var e,t;ed.fullScreenContainer.focus(),await (null===(e=ed.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:L.vH.Down,keyCode:L.AY.VolumeMute,repeat:0,metaState:0})),await (null===(t=ed.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:L.vH.Up,keyCode:L.AY.VolumeMute,repeat:0,metaState:0}))}}),e.push({key:"turnScreenOff",disabled:!ed.running,iconProps:{iconName:x.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{ed.fullScreenContainer.focus(),ed.client.controlMessageWriter.setScreenPowerMode(L.Mr.Off)}},{key:"turnScreenOn",disabled:!ed.running,iconProps:{iconName:x.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{ed.fullScreenContainer.focus(),ed.client.controlMessageWriter.setScreenPowerMode(L.Mr.Normal)}}),ed.running&&e.push({key:"fps",text:"FPS: ".concat(ed.fps),disabled:!0}),e.push({key:"spacer",onRender:()=>(0,r.jsx)(A.X,{})},{key:"separator",disabled:!0,itemType:k.n.Divider}),e.push({key:"NavigationBar",iconProps:{iconName:x.PJ.PanelBottom},canCheck:!0,checked:ed.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,y.aD)(()=>{ed.navigationBarVisible=!ed.navigationBarVisible})}),e}),ec=(0,v.Pi)(function(){return(0,r.jsx)(C.X,{items:el.get()})});var eh=i(6765);let eu=(0,p.Z)({container:{height:"40px",backgroundColor:"#999"},bar:{width:"100%",maxWidth:"300px"},icon:{color:"white"},back:{transform:"rotate(180deg)"}});function ep(e){return!!ed.client&&0===e.button&&(ed.fullScreenContainer.focus(),e.currentTarget.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation(),!0)}function eg(e){return!!ed.client&&0===e.button}function ef(e){ep(e)&&ed.client.controlMessageWriter.backOrScreenOn(L.vH.Down)}function ey(e){eg(e)&&ed.client.controlMessageWriter.backOrScreenOn(L.vH.Up)}function ev(e){ep(e)&&ed.client.controlMessageWriter.injectKeyCode({action:L.vH.Down,keyCode:L.AY.AndroidHome,repeat:0,metaState:0})}function em(e){eg(e)&&ed.client.controlMessageWriter.injectKeyCode({action:L.vH.Up,keyCode:L.AY.AndroidHome,repeat:0,metaState:0})}function eS(e){ep(e)&&ed.client.controlMessageWriter.injectKeyCode({action:L.vH.Down,keyCode:L.AY.AndroidAppSwitch,repeat:0,metaState:0})}function ew(e){eg(e)&&ed.client.controlMessageWriter.injectKeyCode({action:L.vH.Up,keyCode:L.AY.AndroidAppSwitch,repeat:0,metaState:0})}let eb=(0,v.Pi)(function(e){let{className:t,style:i,children:o}=e,n=eu();return ed.navigationBarVisible?(0,r.jsxs)(s.K,{className:(0,eh.z)(n.container,t),verticalFill:!0,horizontalAlign:"center",style:i,children:[o,(0,r.jsxs)(s.K,{className:n.bar,verticalFill:!0,horizontal:!0,horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,r.jsx)(ee.h,{className:(0,eh.z)(n.back,n.icon),iconProps:{iconName:x.PJ.Play},onPointerDown:ef,onPointerUp:ey}),(0,r.jsx)(ee.h,{className:n.icon,iconProps:{iconName:x.PJ.Circle},onPointerDown:ev,onPointerUp:em}),(0,r.jsx)(ee.h,{className:n.icon,iconProps:{iconName:x.PJ.Stop},onPointerDown:eS,onPointerUp:ew})]})]}):(0,r.jsx)("div",{className:t,style:i,children:o})}),ek=(0,p.Z)({video:{transformOrigin:"center center",touchAction:"none"}});function eC(e){if(!ed.client)return;ed.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation();let{x:t,y:i}=ed.clientPositionToDevicePosition(e.clientX,e.clientY);ed.client.controlMessageWriter.injectScroll({screenWidth:ed.client.screenWidth,screenHeight:ed.client.screenHeight,pointerX:t,pointerY:i,scrollX:-e.deltaX/100,scrollY:-e.deltaY/100,buttons:0})}let eL=[L.Zj.Primary,L.Zj.Tertiary,L.Zj.Secondary,L.Zj.Back,L.Zj.Forward];function ex(e,t){let i;if(!ed.client)return;let{pointerType:o}=t;i="mouse"===o?L.YF.Finger:BigInt(t.pointerId);let{x:r,y:n}=ed.clientPositionToDevicePosition(t.clientX,t.clientY),a=ed.hoverHelper.process({action:e,pointerId:i,screenWidth:ed.client.screenWidth,screenHeight:ed.client.screenHeight,pointerX:r,pointerY:n,pressure:t.pressure,actionButton:eL[t.button],buttons:t.buttons});for(let e of a)ed.client.controlMessageWriter.injectTouch(e)}function eA(e){ed.client&&(ed.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation(),e.currentTarget.setPointerCapture(e.pointerId),ex(L.DC.Down,e))}function eP(e){ed.client&&(e.preventDefault(),e.stopPropagation(),ex(0===e.buttons?L.DC.HoverMove:L.DC.Move,e))}function eE(e){ed.client&&(e.preventDefault(),e.stopPropagation(),ex(L.DC.Up,e))}function eT(e){ed.client&&(e.preventDefault(),e.stopPropagation(),ex(L.DC.HoverExit,e),ex(L.DC.Up,e))}function e_(e){e.preventDefault()}function eD(){let e=ek(),[t,i]=(0,w.useState)(null);return(0,w.useEffect)(()=>{if(ed.setRendererContainer(t),t)return t.addEventListener("wheel",eC,{passive:!1}),()=>{t.removeEventListener("wheel",eC)}},[t]),(0,r.jsx)("div",{ref:i,className:e.video,style:{width:ed.width,height:ed.height,transform:"translate(".concat((ed.rotatedWidth-ed.width)/2,"px, ").concat((ed.rotatedHeight-ed.height)/2,"px) rotate(").concat(90*ed.rotation,"deg)")},onPointerDown:eA,onPointerMove:eP,onPointerUp:eE,onPointerCancel:eE,onPointerLeave:eT,onContextMenu:e_})}let eO=(e,t,i,o,r)=>{(0,w.useEffect)(()=>{let r="function"==typeof e?e():e;return r.addEventListener(t,i,o),()=>r.removeEventListener(t,i,o)},r)},ez=w.useLayoutEffect;Symbol("UNINITIALIZED");let eM="undefined"!=typeof localStorage?function(e,t){var i;let[o,r]=(0,w.useState)(()=>localStorage.getItem(e)||t);eO(globalThis,"storage",()=>r(null!==(i=localStorage.getItem(e))&&void 0!==i?i:t),{passive:!0},[e,t]);let n=function(e){let t=function(e){let t=(0,w.useRef)(e);return ez(()=>{t.current=e},[e]),t}(e);return function(e){let t=(0,w.useRef)(e);return t.current}(function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t.current(...i)})}(t=>{r(t),localStorage.setItem(e,t)});return[o,n]}:(e,t)=>[t,()=>{}],eR=(0,p.Z)({layerHost:{position:"absolute",top:0,bottom:0,left:0,right:0,pointerEvents:"none",...g.q5.margin(0)},fullScreenContainer:{flexGrow:1,display:"flex",flexDirection:"column",backgroundColor:"black",":focus-visible":{...g.q5.outline("0")}},fullScreenStatusBar:{display:"flex",color:"white",columnGap:"12px",...g.q5.padding("8px","20px")},spacer:{flexGrow:1}}),ej=(0,v.Pi)(()=>{let e=eR(),t=(0,u.M)("layerHost"),[i,o]=(0,w.useState)(!1);return((0,w.useEffect)(()=>{o(!0)},[]),i)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Z,{id:t,className:e.layerHost}),(0,r.jsx)(a.V,{hidden:!ed.connecting,modalProps:{layerProps:{hostId:t}},dialogContentProps:{title:"Connecting..."},children:(0,r.jsxs)(s.K,{tokens:x.WT,children:[(0,r.jsx)(d.Y,{label:"Downloading scrcpy server...",percentComplete:ed.serverTotalSize?ed.serverDownloadedSize/ed.serverTotalSize:void 0,description:(0,x.CY)(ed.debouncedServerDownloadedSize,ed.serverTotalSize,ed.serverDownloadSpeed)}),(0,r.jsx)(d.Y,{label:"Pushing scrcpy server to device...",progressHidden:0===ed.serverTotalSize||ed.serverDownloadedSize!==ed.serverTotalSize,percentComplete:ed.serverUploadedSize/ed.serverTotalSize,description:(0,x.CY)(ed.debouncedServerUploadedSize,ed.serverTotalSize,ed.serverUploadSpeed)}),(0,r.jsx)(d.Y,{label:"Starting scrcpy server on device...",progressHidden:0===ed.serverTotalSize||ed.serverUploadedSize!==ed.serverTotalSize})]})})]}):null});async function eN(e){if(!ed.client)return;e.preventDefault(),e.stopPropagation();let{type:t,code:i}=e;ed.keyboard["keydown"===t?"down":"up"](i)}function eV(){var e;ed.client&&(null===(e=ed.keyboard)||void 0===e||e.reset())}let eI=(0,v.Pi)(function(e){var t;let{keyboardLockEnabled:i}=e,o=eR(),[n,a]=eM("scrcpy-hint-hidden","false");return i&&ed.isFullScreen&&"true"!==n?(0,r.jsxs)("div",{className:o.fullScreenStatusBar,children:[(0,r.jsx)("div",{children:null===(t=V.GLOBAL_STATE.device)||void 0===t?void 0:t.serial}),(0,r.jsxs)("div",{children:["FPS: ",ed.fps]}),(0,r.jsx)("div",{className:o.spacer}),(0,r.jsx)("div",{children:"Press and hold ESC to exit full screen"}),(0,r.jsx)(l.r,{onClick:()=>a("true"),children:"Don't show again"})]}):null});var eH=(0,v.Pi)(()=>{let e=eR();(0,w.useEffect)(()=>{1===en.decoders.length&&f.H.isSupported()&&(0,y.z)(()=>{en.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:f.H})})},[]);let[t,i]=(0,w.useState)(!1);return(0,w.useEffect)(()=>{if("keyboard"in navigator)return navigator.keyboard.lock(),i(!0),()=>{navigator.keyboard.unlock()}},[]),(0,w.useEffect)(()=>(window.addEventListener("blur",eV),()=>{window.removeEventListener("blur",eV)}),[]),(0,r.jsxs)(s.K,{...x.LE,children:[(0,r.jsx)(S(),{children:(0,r.jsx)("title",{children:"Scrcpy"})}),ed.running?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ec,{}),(0,r.jsx)(s.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:(0,r.jsxs)("div",{ref:ed.setFullScreenContainer,className:e.fullScreenContainer,tabIndex:0,onKeyDown:eN,onKeyUp:eN,children:[(0,r.jsx)(eI,{keyboardLockEnabled:t}),(0,r.jsx)(b.wM,{width:ed.rotatedWidth,height:ed.rotatedHeight,BottomElement:eb,children:(0,r.jsx)(eD,{})})]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.v,{align:"start",children:(0,r.jsx)(h.K,{text:"Connect Scrcpy",disabled:!V.GLOBAL_STATE.adb,onClick:ed.start})}),es.get().map(e=>(0,r.jsx)(eo,{definition:e,value:en[e.group][e.key],onChange:(0,y.aD)((e,t)=>en[e.group][e.key]=t)},e.key)),(0,r.jsx)(ej,{})]})]})})}}]);
//# sourceMappingURL=914-bcbd7e878bdbfb26.js.map